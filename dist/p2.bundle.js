var p2_lib=function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};return e.m=t,e.c=o,e.i=function(t){return t},e.d=function(t,e,o){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=289)}({0:function(t,e,o){var i=t.exports={},n=o(5);i.crossLength=function(t,e){return t[0]*e[1]-t[1]*e[0]},i.crossVZ=function(t,e,o){return i.rotate(t,e,-Math.PI/2),i.scale(t,t,o),t},i.crossZV=function(t,e,o){return i.rotate(t,o,Math.PI/2),i.scale(t,t,e),t},i.rotate=function(t,e,o){if(0!==o){var i=Math.cos(o),n=Math.sin(o),r=e[0],s=e[1];t[0]=i*r-n*s,t[1]=n*r+i*s}else t[0]=e[0],t[1]=e[1]},i.rotate90cw=function(t,e){var o=e[0],i=e[1];t[0]=i,t[1]=-o},i.toLocalFrame=function(t,e,o,n){i.copy(t,e),i.sub(t,t,o),i.rotate(t,t,-n)},i.toGlobalFrame=function(t,e,o,n){i.copy(t,e),i.rotate(t,t,n),i.add(t,t,o)},i.vectorToLocalFrame=function(t,e,o){i.rotate(t,e,-o)},i.vectorToGlobalFrame=function(t,e,o){i.rotate(t,e,o)},i.centroid=function(t,e,o,n){return i.add(t,e,o),i.add(t,t,n),i.scale(t,t,1/3),t},i.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},i.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},i.fromValues=function(t,e){var o=new n.ARRAY_TYPE(2);return o[0]=t,o[1]=e,o},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},i.set=function(t,e,o){return t[0]=e,t[1]=o,t},i.add=function(t,e,o){return t[0]=e[0]+o[0],t[1]=e[1]+o[1],t},i.subtract=function(t,e,o){return t[0]=e[0]-o[0],t[1]=e[1]-o[1],t},i.sub=i.subtract,i.multiply=function(t,e,o){return t[0]=e[0]*o[0],t[1]=e[1]*o[1],t},i.mul=i.multiply,i.divide=function(t,e,o){return t[0]=e[0]/o[0],t[1]=e[1]/o[1],t},i.div=i.divide,i.scale=function(t,e,o){return t[0]=e[0]*o,t[1]=e[1]*o,t},i.distance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(o*o+i*i)},i.dist=i.distance,i.squaredDistance=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],o=t[1];return Math.sqrt(e*e+o*o)},i.len=i.length,i.squaredLength=function(t){var e=t[0],o=t[1];return e*e+o*o},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},i.normalize=function(t,e){var o=e[0],i=e[1],n=o*o+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},i.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},i.lerp=function(t,e,o,i){var n=e[0],r=e[1];return t[0]=n+i*(o[0]-n),t[1]=r+i*(o[1]-r),t},i.reflect=function(t,e,o){var i=e[0]*o[0]+e[1]*o[1];t[0]=e[0]-2*o[0]*i,t[1]=e[1]-2*o[1]*i},i.getLineSegmentsIntersection=function(t,e,o,n,r){var s=i.getLineSegmentsIntersectionFraction(e,o,n,r);return!(s<0)&&(t[0]=e[0]+s*(o[0]-e[0]),t[1]=e[1]+s*(o[1]-e[1]),!0)},i.getLineSegmentsIntersectionFraction=function(t,e,o,i){var n,r,s=e[0]-t[0],a=e[1]-t[1],c=i[0]-o[0],h=i[1]-o[1];return n=(-a*(t[0]-o[0])+s*(t[1]-o[1]))/(-c*a+s*h),r=(c*(t[1]-o[1])-h*(t[0]-o[0]))/(-c*a+s*h),n>=0&&n<=1&&r>=0&&r<=1?r:-1}},14:function(t,e,o){function i(t,e,o,i){this.type=o,i=n.defaults(i,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.collideConnected=i.collideConnected,i.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}t.exports=i;var n=o(5);i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.DISTANCE=1,i.GEAR=2,i.LOCK=3,i.PRISMATIC=4,i.REVOLUTE=5,i.prototype.setStiffness=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.stiffness=t,i.needsUpdate=!0}},i.prototype.setRelaxation=function(t){for(var e=this.equations,o=0;o!==e.length;o++){var i=e[o];i.relaxation=t,i.needsUpdate=!0}}},142:function(t,e){function o(){}t.exports=o,o.area=function(t,e,o){return(e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1])},o.left=function(t,e,i){return o.area(t,e,i)>0},o.leftOn=function(t,e,i){return o.area(t,e,i)>=0},o.right=function(t,e,i){return o.area(t,e,i)<0},o.rightOn=function(t,e,i){return o.area(t,e,i)<=0};var i=[],n=[];o.collinear=function(t,e,r,s){if(s){var a=i,c=n;a[0]=e[0]-t[0],a[1]=e[1]-t[1],c[0]=r[0]-e[0],c[1]=r[1]-e[1];var h=a[0]*c[0]+a[1]*c[1],p=Math.sqrt(a[0]*a[0]+a[1]*a[1]),l=Math.sqrt(c[0]*c[0]+c[1]*c[1]),u=Math.acos(h/(p*l));return u<s}return 0==o.area(t,e,r)},o.sqdist=function(t,e){var o=e[0]-t[0],i=e[1]-t[1];return o*o+i*i}},143:function(t,e){function o(){}t.exports=o,o.eq=function(t,e,o){return o=o||0,Math.abs(t-e)<o}},144:function(t,e,o){t.exports={Polygon:o(268),Point:o(142)}},15:function(t,e,o){function i(t){t=t||{},p.call(this),this.id=t.id||++i._idCounter,this.world=null,this.shapes=[],this.mass=t.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!t.fixedRotation,this.fixedX=!!t.fixedX,this.fixedY=!!t.fixedY,this.massMultiplier=n.create(),this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.interpolatedPosition=n.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=n.fromValues(0,0),this.previousAngle=0,this.velocity=n.fromValues(0,0),t.velocity&&n.copy(this.velocity,t.velocity),this.vlambda=n.fromValues(0,0),this.wlambda=0,this.angle=t.angle||0,this.angularVelocity=t.angularVelocity||0,this.force=n.create(),t.force&&n.copy(this.force,t.force),this.angularForce=t.angularForce||0,this.damping="number"==typeof t.damping?t.damping:.1,this.angularDamping="number"==typeof t.angularDamping?t.angularDamping:.1,this.type=i.STATIC,"undefined"!=typeof t.type?this.type=t.type:t.mass?this.type=i.DYNAMIC:this.type=i.STATIC,this.boundingRadius=0,this.aabb=new h,this.aabbNeedsUpdate=!0,this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.wantsToSleep=!1,this.sleepState=i.AWAKE,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.gravityScale=void 0!==t.gravityScale?t.gravityScale:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==t.ccdSpeedThreshold?t.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==t.ccdIterations?t.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var n=o(0),r=o(144),s=o(20),a=o(45),c=o(30),h=o(28),p=o(32);t.exports=i,i.prototype=new p,i.prototype.constructor=i,i._idCounter=0,i.prototype.updateSolveMassProperties=function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},i.prototype.setDensity=function(t){var e=this.getArea();this.mass=e*t,this.updateMassProperties()},i.prototype.getArea=function(){for(var t=0,e=0;e<this.shapes.length;e++)t+=this.shapes[e].area;return t},i.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new h,u=n.create();i.prototype.updateAABB=function(){for(var t=this.shapes,e=t.length,o=u,i=this.angle,r=0;r!==e;r++){var s=t[r],a=s.angle+i;n.rotate(o,s.position,i),n.add(o,o,this.position),s.computeAABB(l,o,a),0===r?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},i.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=t.length,o=0,i=0;i!==e;i++){var r=t[i],s=n.length(r.position),a=r.boundingRadius;s+a>o&&(o=s+a)}this.boundingRadius=o},i.prototype.addShape=function(t,e,o){if(t.body)throw new Error("A shape can only be added to one body.");t.body=this,e?n.copy(t.position,e):n.set(t.position,0,0),t.angle=o||0,this.shapes.push(t),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},i.prototype.removeShape=function(t){var e=this.shapes.indexOf(t);return e!==-1&&(this.shapes.splice(e,1),this.aabbNeedsUpdate=!0,t.body=null,!0)},i.prototype.updateMassProperties=function(){if(this.type===i.STATIC||this.type===i.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var t=this.shapes,e=t.length,o=this.mass/e,r=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var s=0;s<e;s++){var a=t[s],c=n.squaredLength(a.position),h=a.computeMomentOfInertia(o);r+=h+o*c}this.inertia=r,this.invInertia=r>0?1/r:0}this.invMass=1/this.mass,n.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};n.create();i.prototype.applyForce=function(t,e){if(n.add(this.force,this.force,t),e){var o=n.crossLength(e,t);this.angularForce+=o}};var d=n.create(),f=n.create(),v=n.create();i.prototype.applyForceLocal=function(t,e){e=e||v;var o=d,i=f;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyForce(o,i)};var y=n.create();i.prototype.applyImpulse=function(t,e){if(this.type===i.DYNAMIC){var o=y;if(n.scale(o,t,this.invMass),n.multiply(o,this.massMultiplier,o),n.add(this.velocity,o,this.velocity),e){var r=n.crossLength(e,t);r*=this.invInertia,this.angularVelocity+=r}}};var m=n.create(),g=n.create(),A=n.create();i.prototype.applyImpulseLocal=function(t,e){e=e||A;var o=m,i=g;this.vectorToWorldFrame(o,t),this.vectorToWorldFrame(i,e),this.applyImpulse(o,i)},i.prototype.toLocalFrame=function(t,e){n.toLocalFrame(t,e,this.position,this.angle)},i.prototype.toWorldFrame=function(t,e){n.toGlobalFrame(t,e,this.position,this.angle)},i.prototype.vectorToLocalFrame=function(t,e){n.vectorToLocalFrame(t,e,this.angle)},i.prototype.vectorToWorldFrame=function(t,e){n.vectorToGlobalFrame(t,e,this.angle)},i.prototype.fromPolygon=function(t,e){e=e||{};for(var o=this.shapes.length;o>=0;--o)this.removeShape(this.shapes[o]);var i=new r.Polygon;if(i.vertices=t,i.makeCCW(),"number"==typeof e.removeCollinearPoints&&i.removeCollinearPoints(e.removeCollinearPoints),"undefined"==typeof e.skipSimpleCheck&&!i.isSimple())return!1;this.concavePath=i.vertices.slice(0);for(var o=0;o<this.concavePath.length;o++){var a=[0,0];n.copy(a,this.concavePath[o]),this.concavePath[o]=a}var c;c=e.optimalDecomp?i.decomp():i.quickDecomp();for(var h=n.create(),o=0;o!==c.length;o++){for(var p=new s({vertices:c[o].vertices}),l=0;l!==p.vertices.length;l++){var a=p.vertices[l];n.sub(a,a,p.centerOfMass)}n.scale(h,p.centerOfMass,1),p.updateTriangles(),p.updateCenterOfMass(),p.updateBoundingRadius(),this.addShape(p,h)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var b=(n.fromValues(0,0),n.fromValues(0,0)),E=n.fromValues(0,0),B=n.fromValues(0,0);i.prototype.adjustCenterOfMass=function(){var t=b,e=E,o=B,i=0;n.set(e,0,0);for(var r=0;r!==this.shapes.length;r++){var s=this.shapes[r];n.scale(t,s.position,s.area),n.add(e,e,t),i+=s.area}n.scale(o,e,1/i);for(var r=0;r!==this.shapes.length;r++){var s=this.shapes[r];n.sub(s.position,s.position,o)}n.add(this.position,this.position,o);for(var r=0;this.concavePath&&r<this.concavePath.length;r++)n.sub(this.concavePath[r],this.concavePath[r],o);this.updateMassProperties(),this.updateBoundingRadius()},i.prototype.setZeroForce=function(){n.set(this.force,0,0),this.angularForce=0},i.prototype.resetConstraintVelocity=function(){var t=this,e=t.vlambda;n.set(e,0,0),t.wlambda=0},i.prototype.addConstraintVelocity=function(){var t=this,e=t.velocity;n.add(e,e,t.vlambda),t.angularVelocity+=t.wlambda},i.prototype.applyDamping=function(t){if(this.type===i.DYNAMIC){var e=this.velocity;n.scale(e,e,Math.pow(1-this.damping,t)),this.angularVelocity*=Math.pow(1-this.angularDamping,t)}},i.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=i.AWAKE,this.idleTime=0,t!==i.AWAKE&&this.emit(i.wakeUpEvent)},i.prototype.sleep=function(){this.sleepState=i.SLEEPING,this.angularVelocity=0,this.angularForce=0,n.set(this.velocity,0,0),n.set(this.force,0,0),this.emit(i.sleepEvent)},i.prototype.sleepTick=function(t,e,o){if(this.allowSleep&&this.type!==i.SLEEPING){this.wantsToSleep=!1;var r=(this.sleepState,n.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),s=Math.pow(this.sleepSpeedLimit,2);r>=s?(this.idleTime=0,this.sleepState=i.AWAKE):(this.idleTime+=o,this.sleepState=i.SLEEPY),this.idleTime>this.sleepTimeLimit&&(e?this.wantsToSleep=!0:this.sleep())}},i.prototype.overlaps=function(t){return this.world.overlapKeeper.bodiesAreOverlapping(this,t)};var w=n.create(),P=n.create();i.prototype.integrate=function(t){var e=this.invMass,o=this.force,i=this.position,r=this.velocity;n.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*t),n.scale(w,o,t*e),n.multiply(w,this.massMultiplier,w),n.add(r,w,r),this.integrateToTimeOfImpact(t)||(n.scale(P,r,t),n.add(i,i,P),this.fixedRotation||(this.angle+=this.angularVelocity*t)),this.aabbNeedsUpdate=!0};var q=new a,L=new c({mode:c.ALL}),S=n.create(),x=n.create(),F=n.create(),C=n.create();i.prototype.integrateToTimeOfImpact=function(t){if(this.ccdSpeedThreshold<0||n.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;n.normalize(S,this.velocity),n.scale(x,this.velocity,t),n.add(x,x,this.position),n.sub(F,x,this.position);var e,o=this.angularVelocity*t,i=n.length(F),r=1,s=this;if(q.reset(),L.callback=function(t){t.body!==s&&(e=t.body,t.getHitPoint(x,L),n.sub(F,x,s.position),r=n.length(F)/i,t.stop())},n.copy(L.from,this.position),n.copy(L.to,x),L.update(),this.world.raycast(q,L),!e)return!1;var a=this.angle;n.copy(C,this.position);for(var c=0,h=0,p=0,l=r;l>=h&&c<this.ccdIterations;){c++,p=(l-h)/2,n.scale(P,F,r),n.add(this.position,C,P),this.angle=a+o*r,this.updateAABB();var u=this.aabb.overlaps(e.aabb)&&this.world.narrowphase.bodiesOverlap(this,e);u?h=p:l=p}return r=p,n.copy(this.position,C),this.angle=a,n.scale(P,F,r),n.add(this.position,this.position,P),this.fixedRotation||(this.angle+=o*r),!0},i.prototype.getVelocityAtPoint=function(t,e){return n.crossVZ(t,e,this.angularVelocity),n.subtract(t,this.velocity,t),t},i.sleepyEvent={type:"sleepy"},i.sleepEvent={type:"sleep"},i.wakeUpEvent={type:"wakeup"},i.DYNAMIC=1,i.STATIC=2,i.KINEMATIC=4,i.AWAKE=0,i.SLEEPY=1,i.SLEEPING=2},151:function(t,e,o){var i=t.exports={AABB:o(28),AngleLockEquation:o(81),Body:o(15),Broadphase:o(29),Capsule:o(88),Circle:o(33),Constraint:o(14),ContactEquation:o(31),ContactEquationPool:o(91),ContactMaterial:o(84),Convex:o(20),DistanceConstraint:o(76),Equation:o(8),EventEmitter:o(32),FrictionEquation:o(19),FrictionEquationPool:o(92),GearConstraint:o(77),GSSolver:o(90),Heightfield:o(176),Line:o(89),LockConstraint:o(78),Material:o(46),Narrowphase:o(74),NaiveBroadphase:o(173),Particle:o(48),Plane:o(49),Pool:o(17),RevoluteConstraint:o(80),PrismaticConstraint:o(79),Ray:o(30),RaycastResult:o(45),Box:o(87),RotationalVelocityEquation:o(83),SAPBroadphase:o(75),Shape:o(9),Solver:o(50),Spring:o(47),TopDownVehicle:o(175),LinearSpring:o(85),RotationalSpring:o(86),Utils:o(5),World:o(182),vec2:o(0),version:o(73).version};Object.defineProperty(i,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},17:function(t,e){function o(t){t=t||{},this.objects=[],void 0!==t.size&&this.resize(t.size)}t.exports=o,o.prototype.resize=function(t){for(var e=this.objects;e.length>t;)e.pop();for(;e.length<t;)e.push(this.create());return this},o.prototype.get=function(){var t=this.objects;return t.length?t.pop():this.create()},o.prototype.release=function(t){return this.destroy(t),this.objects.push(t),this}},173:function(t,e,o){function i(){n.call(this,n.NAIVE)}var n=(o(33),o(49),o(9),o(48),o(29));o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.getCollisionPairs=function(t){var e=t.bodies,o=this.result;o.length=0;for(var i=0,r=e.length;i!==r;i++)for(var s=e[i],a=0;a<i;a++){var c=e[a];n.canCollide(s,c)&&this.boundingVolumeCheck(s,c)&&o.push(s,c)}return o},i.prototype.aabbQuery=function(t,e,o){o=o||[];for(var i=t.bodies,n=0;n<i.length;n++){var r=i[n];r.aabbNeedsUpdate&&r.updateAABB(),r.aabb.overlaps(e)&&o.push(r)}return o}},174:function(t,e){var o={};o.GetArea=function(t){if(t.length<6)return 0;for(var e=t.length-2,o=0,i=0;i<e;i+=2)o+=(t[i+2]-t[i])*(t[i+1]+t[i+3]);return o+=(t[0]-t[e])*(t[e+1]+t[1]),.5*-o},o.Triangulate=function(t){var e=t.length>>1;if(e<3)return[];for(var i=[],n=[],r=0;r<e;r++)n.push(r);for(var r=0,s=e;s>3;){var a=n[(r+0)%s],c=n[(r+1)%s],h=n[(r+2)%s],p=t[2*a],l=t[2*a+1],u=t[2*c],d=t[2*c+1],f=t[2*h],v=t[2*h+1],y=!1;if(o._convex(p,l,u,d,f,v)){y=!0;for(var m=0;m<s;m++){var g=n[m];if(g!=a&&g!=c&&g!=h&&o._PointInTriangle(t[2*g],t[2*g+1],p,l,u,d,f,v)){y=!1;break}}}if(y)i.push(a,c,h),n.splice((r+1)%s,1),s--,r=0;else if(r++>3*s)break}return i.push(n[0],n[1],n[2]),i},o._PointInTriangle=function(t,e,o,i,n,r,s,a){var c=s-o,h=a-i,p=n-o,l=r-i,u=t-o,d=e-i,f=c*c+h*h,v=c*p+h*l,y=c*u+h*d,m=p*p+l*l,g=p*u+l*d,A=1/(f*m-v*v),b=(m*y-v*g)*A,E=(f*g-v*y)*A;return b>=0&&E>=0&&b+E<1},o._convex=function(t,e,o,i,n,r){return(e-i)*(n-o)+(o-t)*(r-i)>=0},t.exports=o},175:function(t,e,o){function i(t,e){e=e||{},this.chassisBody=t,this.wheels=[],this.groundBody=new c({mass:0}),this.world=null;var o=this;this.preStepCallback=function(){o.update()}}function n(t,e){e=e||{},this.vehicle=t,this.forwardEquation=new a(t.chassisBody,t.groundBody),this.sideEquation=new a(t.chassisBody,t.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==e.sideFriction?e.sideFriction:5),this.localForwardVector=r.fromValues(0,1),e.localForwardVector&&r.copy(this.localForwardVector,e.localForwardVector),this.localPosition=r.fromValues(0,0),e.localPosition&&r.copy(this.localPosition,e.localPosition),s.apply(this,t.chassisBody,t.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var r=o(0),s=(o(5),o(14)),a=o(19),c=o(15);t.exports=i,i.prototype.addToWorld=function(t){this.world=t,t.addBody(this.groundBody),t.on("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.addConstraint(o)}},i.prototype.removeFromWorld=function(){var t=this.world;t.removeBody(this.groundBody),t.off("preStep",this.preStepCallback);for(var e=0;e<this.wheels.length;e++){var o=this.wheels[e];t.removeConstraint(o)}this.world=null},i.prototype.addWheel=function(t){var e=new n(this,t);return this.wheels.push(e),e},i.prototype.update=function(){for(var t=0;t<this.wheels.length;t++)this.wheels[t].update()},n.prototype=new s,n.prototype.setBrakeForce=function(t){this.forwardEquation.setSlipForce(t)},n.prototype.setSideFriction=function(t){this.sideEquation.setSlipForce(t)};var h=r.create(),p=r.create();n.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(p,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(h,p),r.dot(h,p)};var l=r.create();n.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),r.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),r.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),r.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),r.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),r.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),r.normalize(l,this.forwardEquation.t),r.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},176:function(t,e,o){function i(t){if(Array.isArray(arguments[0])){if(t={heights:arguments[0]},"object"==typeof arguments[1])for(var e in arguments[1])t[e]=arguments[1][e];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}t=t||{},this.heights=t.heights?t.heights.slice(0):[],this.maxValue=t.maxValue||null,this.minValue=t.minValue||null,this.elementWidth=t.elementWidth||.1,void 0!==t.maxValue&&void 0!==t.minValue||this.updateMaxMinValues(),t.type=n.HEIGHTFIELD,n.call(this,t)}var n=o(9),r=o(0);o(5);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.updateMaxMinValues=function(){for(var t=this.heights,e=t[0],o=t[0],i=0;i!==t.length;i++){var n=t[i];n>e&&(e=n),n<o&&(o=n)}this.maxValue=e,this.minValue=o},i.prototype.computeMomentOfInertia=function(t){return Number.MAX_VALUE},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.updateArea=function(){for(var t=this.heights,e=0,o=0;o<t.length-1;o++)e+=(t[o]+t[o+1])/2*this.elementWidth;this.area=e};var s=[r.create(),r.create(),r.create(),r.create()];i.prototype.computeAABB=function(t,e,o){r.set(s[0],0,this.maxValue),r.set(s[1],this.elementWidth*this.heights.length,this.maxValue),r.set(s[2],this.elementWidth*this.heights.length,this.minValue),r.set(s[3],0,this.minValue),t.setFromPoints(s,e,o)},i.prototype.getLineSegment=function(t,e,o){var i=this.heights,n=this.elementWidth;r.set(t,o*n,i[o]),r.set(e,(o+1)*n,i[o+1])},i.prototype.getSegmentIndex=function(t){return Math.floor(t[0]/this.elementWidth)},i.prototype.getClampedSegmentIndex=function(t){var e=this.getSegmentIndex(t);return e=Math.min(this.heights.length,Math.max(e,0))};var a=(r.create(),r.create()),c=r.create(),h=r.create(),p=r.create(),l=r.create();r.fromValues(0,1);i.prototype.raycast=function(t,e,o,i){var n=e.from,s=e.to,u=(e.direction,a),d=c,f=h,v=p,y=l;r.toLocalFrame(v,n,o,i),r.toLocalFrame(y,s,o,i);var m=this.getClampedSegmentIndex(v),g=this.getClampedSegmentIndex(y);if(m>g){var A=m;m=g,g=A}for(var b=0;b<this.heights.length-1;b++){this.getLineSegment(d,f,b);var E=r.getLineSegmentsIntersectionFraction(v,y,d,f);if(E>=0&&(r.sub(u,f,d),r.rotate(u,u,i+Math.PI/2),r.normalize(u,u),e.reportIntersection(t,E,u,-1),t.shouldStop(e)))return}}},177:function(t,e,o){function i(){r.apply(this,arguments)}var n=o(96),r=o(17);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.reset(),this}},178:function(t,e,o){function i(){r.apply(this,arguments)}var n=o(95),r=o(17);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.reset(),this}},179:function(t,e,o){function i(){this.overlappingShapesLastState=new n,this.overlappingShapesCurrentState=new n,this.recordPool=new r({size:16}),this.tmpDict=new n,this.tmpArray1=[]}var n=o(94),r=(o(93),o(180));o(5);t.exports=i,i.prototype.tick=function(){for(var t=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,o=t.keys.length;o--;){var i=t.keys[o],n=t.getByKey(i);e.getByKey(i);n&&this.recordPool.release(n)}t.reset(),t.copy(e),e.reset()},i.prototype.setOverlapping=function(t,e,o,i){var n=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!n.get(e.id,i.id)){var r=this.recordPool.get();r.set(t,e,o,i),n.set(e.id,i.id,r)}},i.prototype.getNewOverlaps=function(t){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,t)},i.prototype.getEndOverlaps=function(t){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,t)},i.prototype.bodiesAreOverlapping=function(t,e){for(var o=this.overlappingShapesCurrentState,i=o.keys.length;i--;){var n=o.keys[i],r=o.data[n];if(r.bodyA===t&&r.bodyB===e||r.bodyA===e&&r.bodyB===t)return!0}return!1},i.prototype.getDiff=function(t,e,o){var o=o||[],i=t,n=e;o.length=0;for(var r=n.keys.length;r--;){var s=n.keys[r],a=n.data[s];if(!a)throw new Error("Key "+s+" had no data!");var c=i.data[s];c||o.push(a)}return o},i.prototype.isNewOverlap=function(t,e){var o=0|t.id,i=0|e.id,n=this.overlappingShapesLastState,r=this.overlappingShapesCurrentState;return!n.get(o,i)&&!!r.get(o,i)},i.prototype.getNewBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},i.prototype.getEndBodyOverlaps=function(t){this.tmpArray1.length=0;var e=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(e,t)},i.prototype.getBodyDiff=function(t,e){e=e||[];for(var o=this.tmpDict,i=t.length;i--;){var n=t[i];o.set(0|n.bodyA.id,0|n.bodyB.id,n)}for(i=o.keys.length;i--;){var n=o.getByKey(o.keys[i]);n&&e.push(n.bodyA,n.bodyB)}return o.reset(),e}},180:function(t,e,o){function i(){r.apply(this,arguments)}var n=o(93),r=o(17);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=t.shapeA=t.shapeB=null,this}},181:function(t,e,o){function i(t){this.nodePool=new n({size:16}),this.islandPool=new r({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var n=(o(0),o(95),o(96),o(177)),r=o(178),s=o(15);t.exports=i,i.getUnvisitedNode=function(t){for(var e=t.length,o=0;o!==e;o++){var i=t[o];if(!i.visited&&i.body.type===s.DYNAMIC)return i}return!1},i.prototype.visit=function(t,e,o){e.push(t.body);for(var i=t.equations.length,n=0;n!==i;n++){var r=t.equations[n];o.indexOf(r)===-1&&o.push(r)}},i.prototype.bfs=function(t,e,o){var n=this.queue;for(n.length=0,n.push(t),t.visited=!0,this.visit(t,e,o);n.length;)for(var r,a=n.pop();r=i.getUnvisitedNode(a.neighbors);)r.visited=!0,this.visit(r,e,o),r.body.type===s.DYNAMIC&&n.push(r)},i.prototype.split=function(t){for(var e=t.bodies,o=this.nodes,n=this.equations;o.length;)this.nodePool.release(o.pop());for(var r=0;r!==e.length;r++){var s=this.nodePool.get();s.body=e[r],o.push(s)}for(var a=0;a!==n.length;a++){var c=n[a],r=e.indexOf(c.bodyA),h=e.indexOf(c.bodyB),p=o[r],l=o[h];p.neighbors.push(l),l.neighbors.push(p),p.equations.push(c),l.equations.push(c)}for(var u=this.islands,r=0;r<u.length;r++)this.islandPool.release(u[r]);u.length=0;for(var d;d=i.getUnvisitedNode(o);){var f=this.islandPool.get();this.bfs(d,f.bodies,f.equations),u.push(f)}return u}},182:function(t,e,o){function i(t){l.apply(this),t=t||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=t.solver||new n,this.narrowphase=new m(this),this.islandManager=new b,this.gravity=r.fromValues(0,-9.78),t.gravity&&r.copy(this.gravity,t.gravity),this.frictionGravity=r.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=t.broadphase||new y,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new d,this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"==typeof t.islandSplit||!!t.islandSplit,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=i.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new A}var n=o(90),r=(o(50),o(30),o(0)),s=o(33),a=o(20),c=(o(89),o(49)),h=o(88),p=o(48),l=o(32),u=o(15),d=(o(9),o(85),o(46)),f=o(84),v=(o(76),o(14),o(78),o(80),o(79),o(77),o(73),o(29),o(28)),y=o(75),m=o(74),g=o(5),A=o(179),b=o(181);o(86);t.exports=i,i.prototype=new Object(l.prototype),i.prototype.constructor=i,i.NO_SLEEPING=1,i.BODY_SLEEPING=2,i.ISLAND_SLEEPING=4,i.prototype.addConstraint=function(t){this.constraints.push(t)},i.prototype.addContactMaterial=function(t){this.contactMaterials.push(t)},i.prototype.removeContactMaterial=function(t){var e=this.contactMaterials.indexOf(t);e!==-1&&g.splice(this.contactMaterials,e,1)},i.prototype.getContactMaterial=function(t,e){for(var o=this.contactMaterials,i=0,n=o.length;i!==n;i++){var r=o[i];if(r.materialA.id===t.id&&r.materialB.id===e.id||r.materialA.id===e.id&&r.materialB.id===t.id)return r}return!1},i.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);e!==-1&&g.splice(this.constraints,e,1)};var E=(r.create(),r.create(),r.create(),r.create(),r.create(),r.create(),r.create()),B=r.fromValues(0,0),w=r.fromValues(0,0);r.fromValues(0,0),r.fromValues(0,0);i.prototype.step=function(t,e,o){if(o=o||10,e=e||0,0===e)this.internalStep(t),this.time+=t;else{this.accumulator+=e;for(var i=0;this.accumulator>=t&&i<o;)this.internalStep(t),this.time+=t,this.accumulator-=t,i++;for(var n=this.accumulator%t/t,s=0;s!==this.bodies.length;s++){var a=this.bodies[s];r.lerp(a.interpolatedPosition,a.previousPosition,a.position,n),a.interpolatedAngle=a.previousAngle+n*(a.angle-a.previousAngle)}}};var P=[];i.prototype.internalStep=function(t){this.stepping=!0;var e=this.springs.length,o=this.springs,n=this.bodies,s=this.gravity,a=this.solver,c=this.bodies.length,h=this.broadphase,p=this.narrowphase,l=this.constraints,d=E,f=(r.scale,r.add),v=(r.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=t,this.useWorldGravityAsFrictionGravity){var y=r.length(this.gravity);0===y&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=y)}if(this.applyGravity)for(var m=0;m!==c;m++){var A=n[m],b=A.force;A.type===u.DYNAMIC&&A.sleepState!==u.SLEEPING&&(r.scale(d,s,A.mass*A.gravityScale),f(b,b,d))}if(this.applySpringForces)for(var m=0;m!==e;m++){var B=o[m];B.applyForce()}if(this.applyDamping)for(var m=0;m!==c;m++){var A=n[m];A.type===u.DYNAMIC&&A.applyDamping(t)}for(var w=h.getCollisionPairs(this),q=this.disabledBodyCollisionPairs,m=q.length-2;m>=0;m-=2)for(var L=w.length-2;L>=0;L-=2)(q[m]===w[L]&&q[m+1]===w[L+1]||q[m+1]===w[L]&&q[m]===w[L+1])&&w.splice(L,2);var S=l.length;for(m=0;m!==S;m++){var x=l[m];if(!x.collideConnected)for(var L=w.length-2;L>=0;L-=2)(x.bodyA===w[L]&&x.bodyB===w[L+1]||x.bodyB===w[L]&&x.bodyA===w[L+1])&&w.splice(L,2)}this.postBroadphaseEvent.pairs=w,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,p.reset(this);for(var m=0,F=w.length;m!==F;m+=2)for(var C=w[m],M=w[m+1],I=0,V=C.shapes.length;I!==V;I++)for(var R=C.shapes[I],T=R.position,N=R.angle,O=0,G=M.shapes.length;O!==G;O++){var k=M.shapes[O],_=k.position,U=k.angle,D=this.defaultContactMaterial;if(R.material&&k.material){var W=this.getContactMaterial(R.material,k.material);W&&(D=W)}this.runNarrowphase(p,C,R,T,N,M,k,_,U,D,this.frictionGravity)}for(var m=0;m!==c;m++){var X=n[m];X._wakeUpAfterNarrowphase&&(X.wakeUp(),X._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(P);for(var z=this.endContactEvent,O=P.length;O--;){var Y=P[O];z.shapeA=Y.shapeA,z.shapeB=Y.shapeB,z.bodyA=Y.bodyA,z.bodyB=Y.bodyB,this.emit(z)}P.length=0}var H=this.preSolveEvent;H.contactEquations=p.contactEquations,H.frictionEquations=p.frictionEquations,this.emit(H),H.contactEquations=H.frictionEquations=null;var S=l.length;for(m=0;m!==S;m++)l[m].update();if(p.contactEquations.length||p.frictionEquations.length||S)if(this.islandSplit){for(v.equations.length=0,g.appendArray(v.equations,p.contactEquations),g.appendArray(v.equations,p.frictionEquations),m=0;m!==S;m++)g.appendArray(v.equations,l[m].equations);v.split(this);for(var m=0;m!==v.islands.length;m++){var K=v.islands[m];K.equations.length&&a.solveIsland(t,K)}}else{for(a.addEquations(p.contactEquations),a.addEquations(p.frictionEquations),m=0;m!==S;m++)a.addEquations(l[m].equations);
this.solveConstraints&&a.solve(t,this),a.removeAllEquations()}for(var m=0;m!==c;m++){var X=n[m];X.integrate(t)}for(var m=0;m!==c;m++)n[m].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var j=this.impactEvent,m=0;m!==p.contactEquations.length;m++){var Z=p.contactEquations[m];Z.firstImpact&&(j.bodyA=Z.bodyA,j.bodyB=Z.bodyB,j.shapeA=Z.shapeA,j.shapeB=Z.shapeB,j.contactEquation=Z,this.emit(j))}if(this.sleepMode===i.BODY_SLEEPING)for(m=0;m!==c;m++)n[m].sleepTick(this.time,!1,t);else if(this.sleepMode===i.ISLAND_SLEEPING&&this.islandSplit){for(m=0;m!==c;m++)n[m].sleepTick(this.time,!0,t);for(var m=0;m<this.islandManager.islands.length;m++){var K=this.islandManager.islands[m];K.wantsToSleep()&&K.sleep()}}this.stepping=!1;for(var J=this.bodiesToBeRemoved,m=0;m!==J.length;m++)this.removeBody(J[m]);J.length=0,this.emit(this.postStepEvent)},i.prototype.runNarrowphase=function(t,e,o,i,n,s,a,c,h,p,l){if(0!==(o.collisionGroup&a.collisionMask)&&0!==(a.collisionGroup&o.collisionMask)){r.rotate(B,i,e.angle),r.rotate(w,c,s.angle),r.add(B,B,e.position),r.add(w,w,s.position);var d=n+e.angle,f=h+s.angle;t.enableFriction=p.friction>0,t.frictionCoefficient=p.friction;var v;v=e.type===u.STATIC||e.type===u.KINEMATIC?s.mass:s.type===u.STATIC||s.type===u.KINEMATIC?e.mass:e.mass*s.mass/(e.mass+s.mass),t.slipForce=p.friction*l*v,t.restitution=p.restitution,t.surfaceVelocity=p.surfaceVelocity,t.frictionStiffness=p.frictionStiffness,t.frictionRelaxation=p.frictionRelaxation,t.stiffness=p.stiffness,t.relaxation=p.relaxation,t.contactSkinSize=p.contactSkinSize,t.enabledEquations=e.collisionResponse&&s.collisionResponse&&o.collisionResponse&&a.collisionResponse;var y=t[o.type|a.type],m=0;if(y){var g=o.sensor||a.sensor,A=t.frictionEquations.length;m=o.type<a.type?y.call(t,e,o,B,d,s,a,w,f,g):y.call(t,s,a,w,f,e,o,B,d,g);var b=t.frictionEquations.length-A;if(m){if(e.allowSleep&&e.type===u.DYNAMIC&&e.sleepState===u.SLEEPING&&s.sleepState===u.AWAKE&&s.type!==u.STATIC){var E=r.squaredLength(s.velocity)+Math.pow(s.angularVelocity,2),P=Math.pow(s.sleepSpeedLimit,2);E>=2*P&&(e._wakeUpAfterNarrowphase=!0)}if(s.allowSleep&&s.type===u.DYNAMIC&&s.sleepState===u.SLEEPING&&e.sleepState===u.AWAKE&&e.type!==u.STATIC){var q=r.squaredLength(e.velocity)+Math.pow(e.angularVelocity,2),L=Math.pow(e.sleepSpeedLimit,2);q>=2*L&&(s._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(e,o,s,a),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(o,a)){var S=this.beginContactEvent;if(S.shapeA=o,S.shapeB=a,S.bodyA=e,S.bodyB=s,S.contactEquations.length=0,"number"==typeof m)for(var x=t.contactEquations.length-m;x<t.contactEquations.length;x++)S.contactEquations.push(t.contactEquations[x]);this.emit(S)}if("number"==typeof m&&b>1)for(var x=t.frictionEquations.length-b;x<t.frictionEquations.length;x++){var F=t.frictionEquations[x];F.setSlipForce(F.getSlipForce()/b)}}}}},i.prototype.addSpring=function(t){this.springs.push(t);var e=this.addSpringEvent;e.spring=t,this.emit(e),e.spring=null},i.prototype.removeSpring=function(t){var e=this.springs.indexOf(t);e!==-1&&g.splice(this.springs,e,1)},i.prototype.addBody=function(t){if(this.bodies.indexOf(t)===-1){this.bodies.push(t),t.world=this;var e=this.addBodyEvent;e.body=t,this.emit(e),e.body=null}},i.prototype.removeBody=function(t){if(this.stepping)this.bodiesToBeRemoved.push(t);else{t.world=null;var e=this.bodies.indexOf(t);e!==-1&&(g.splice(this.bodies,e,1),this.removeBodyEvent.body=t,t.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},i.prototype.getBodyById=function(t){for(var e=this.bodies,o=0;o<e.length;o++){var i=e[o];if(i.id===t)return i}return!1},i.prototype.disableBodyCollision=function(t,e){this.disabledBodyCollisionPairs.push(t,e)},i.prototype.enableBodyCollision=function(t,e){for(var o=this.disabledBodyCollisionPairs,i=0;i<o.length;i+=2)if(o[i]===t&&o[i+1]===e||o[i+1]===t&&o[i]===e)return void o.splice(i,2)},i.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var t=this.constraints,e=t.length-1;e>=0;e--)this.removeConstraint(t[e]);for(var o=this.bodies,e=o.length-1;e>=0;e--)this.removeBody(o[e]);for(var n=this.springs,e=n.length-1;e>=0;e--)this.removeSpring(n[e]);for(var r=this.contactMaterials,e=r.length-1;e>=0;e--)this.removeContactMaterial(r[e]);i.apply(this)};var q=r.create(),L=(r.fromValues(0,0),r.fromValues(0,0));i.prototype.hitTest=function(t,e,o){o=o||0;var i=new u({position:t}),n=new p,l=t,d=0,f=q,v=L;i.addShape(n);for(var y=this.narrowphase,m=[],g=0,A=e.length;g!==A;g++)for(var b=e[g],E=0,B=b.shapes.length;E!==B;E++){var w=b.shapes[E];r.rotate(f,w.position,b.angle),r.add(f,f,b.position);var P=w.angle+b.angle;(w instanceof s&&y.circleParticle(b,w,f,P,i,n,l,d,!0)||w instanceof a&&y.particleConvex(i,n,l,d,b,w,f,P,!0)||w instanceof c&&y.particlePlane(i,n,l,d,b,w,f,P,!0)||w instanceof h&&y.particleCapsule(i,n,l,d,b,w,f,P,!0)||w instanceof p&&r.squaredLength(r.sub(v,f,t))<o*o)&&m.push(b)}return m},i.prototype.setGlobalStiffness=function(t){for(var e=this.constraints,o=0;o!==e.length;o++)for(var i=e[o],n=0;n!==i.equations.length;n++){var r=i.equations[n];r.stiffness=t,r.needsUpdate=!0}for(var s=this.contactMaterials,o=0;o!==s.length;o++){var i=s[o];i.stiffness=i.frictionStiffness=t}var i=this.defaultContactMaterial;i.stiffness=i.frictionStiffness=t},i.prototype.setGlobalRelaxation=function(t){for(var e=0;e!==this.constraints.length;e++)for(var o=this.constraints[e],i=0;i!==o.equations.length;i++){var n=o.equations[i];n.relaxation=t,n.needsUpdate=!0}for(var e=0;e!==this.contactMaterials.length;e++){var o=this.contactMaterials[e];o.relaxation=o.frictionRelaxation=t}var o=this.defaultContactMaterial;o.relaxation=o.frictionRelaxation=t};var S=new v,x=[];i.prototype.raycast=function(t,e){return e.getAABB(S),this.broadphase.aabbQuery(this,S,x),e.intersectBodies(t,x),x.length=0,t.hasHit()}},19:function(t,e,o){function i(t,e,o){r.call(this,t,e,-o,o),this.contactPointA=n.create(),this.contactPointB=n.create(),this.t=n.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var n=o(0),r=o(8);o(5);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.setSlipForce=function(t){this.maxForce=t,this.minForce=-t},i.prototype.getSlipForce=function(){return this.maxForce},i.prototype.computeB=function(t,e,o){var i=(this.bodyA,this.bodyB,this.contactPointA),r=this.contactPointB,s=this.t,a=this.G;a[0]=-s[0],a[1]=-s[1],a[2]=-n.crossLength(i,s),a[3]=s[0],a[4]=s[1],a[5]=n.crossLength(r,s);var c=this.computeGW(),h=this.computeGiMf(),p=-c*e-o*h;return p}},20:function(t,e,o){function i(t){Array.isArray(arguments[0])&&(t={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),t=t||{},this.vertices=[];for(var e=void 0!==t.vertices?t.vertices:[],o=0;o<e.length;o++){var i=r.create();r.copy(i,e[o]),this.vertices.push(i)}if(this.axes=[],t.axes)for(var o=0;o<t.axes.length;o++){var s=r.create();r.copy(s,t.axes[o]),this.axes.push(s)}else for(var o=0;o<this.vertices.length;o++){var a=this.vertices[o],c=this.vertices[(o+1)%this.vertices.length],h=r.create();r.sub(h,c,a),r.rotate90cw(h,h),r.normalize(h,h),this.axes.push(h)}if(this.centerOfMass=r.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,t.type=n.CONVEX,n.call(this,t),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var n=o(9),r=o(0),s=o(174);o(144);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var a=r.create(),c=r.create();i.prototype.projectOntoLocalAxis=function(t,e){for(var o,i,n=null,s=null,t=a,c=0;c<this.vertices.length;c++)o=this.vertices[c],i=r.dot(o,t),(null===n||i>n)&&(n=i),(null===s||i<s)&&(s=i);if(s>n){var h=s;s=n,n=h}r.set(e,s,n)},i.prototype.projectOntoWorldAxis=function(t,e,o,i){var n=c;this.projectOntoLocalAxis(t,i),0!==o?r.rotate(n,t,o):n=t;var s=r.dot(e,n);r.set(i,i[0]+s,i[1]+s)},i.prototype.updateTriangles=function(){this.triangles.length=0;for(var t=[],e=0;e<this.vertices.length;e++){var o=this.vertices[e];t.push(o[0],o[1])}for(var i=s.Triangulate(t),e=0;e<i.length;e+=3){var n=i[e],r=i[e+1],a=i[e+2];this.triangles.push([n,r,a])}};var h=r.create(),p=r.create(),l=r.create(),u=r.create(),d=r.create();r.create(),r.create(),r.create(),r.create();i.prototype.updateCenterOfMass=function(){var t=this.triangles,e=this.vertices,o=this.centerOfMass,n=h,s=l,a=u,c=d,f=p;r.set(o,0,0);for(var v=0,y=0;y!==t.length;y++){var m=t[y],s=e[m[0]],a=e[m[1]],c=e[m[2]];r.centroid(n,s,a,c);var g=i.triangleArea(s,a,c);v+=g,r.scale(f,n,g),r.add(o,o,f)}r.scale(o,o,1/v)},i.prototype.computeMomentOfInertia=function(t){for(var e=0,o=0,i=this.vertices.length,n=i-1,s=0;s<i;n=s,s++){var a=this.vertices[n],c=this.vertices[s],h=Math.abs(r.crossLength(a,c)),p=r.dot(c,c)+r.dot(c,a)+r.dot(a,a);e+=h*p,o+=h}return t/6*(e/o)},i.prototype.updateBoundingRadius=function(){for(var t=this.vertices,e=0,o=0;o!==t.length;o++){var i=r.squaredLength(t[o]);i>e&&(e=i)}this.boundingRadius=Math.sqrt(e)},i.triangleArea=function(t,e,o){return.5*((e[0]-t[0])*(o[1]-t[1])-(o[0]-t[0])*(e[1]-t[1]))},i.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var t=this.triangles,e=this.vertices,o=0;o!==t.length;o++){var n=t[o],r=e[n[0]],s=e[n[1]],a=e[n[2]],c=i.triangleArea(r,s,a);this.area+=c}},i.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)};var f=r.create(),v=r.create(),y=r.create();i.prototype.raycast=function(t,e,o,i){var n=f,s=v,a=y,c=this.vertices;r.toLocalFrame(n,e.from,o,i),r.toLocalFrame(s,e.to,o,i);for(var h=c.length,p=0;p<h&&!t.shouldStop(e);p++){var l=c[p],u=c[(p+1)%h],d=r.getLineSegmentsIntersectionFraction(n,s,l,u);d>=0&&(r.sub(a,u,l),r.rotate(a,a,-Math.PI/2+i),r.normalize(a,a),e.reportIntersection(t,d,a,p))}}},267:function(t,e,o){function i(){}var n=o(143);t.exports=i,i.lineInt=function(t,e,o){o=o||0;var i,r,s,a,c,h,p,l=[0,0];return i=t[1][1]-t[0][1],r=t[0][0]-t[1][0],s=i*t[0][0]+r*t[0][1],a=e[1][1]-e[0][1],c=e[0][0]-e[1][0],h=a*e[0][0]+c*e[0][1],p=i*c-a*r,n.eq(p,0,o)||(l[0]=(c*s-r*h)/p,l[1]=(i*h-a*s)/p),l},i.segmentsIntersect=function(t,e,o,i){var n=e[0]-t[0],r=e[1]-t[1],s=i[0]-o[0],a=i[1]-o[1];if(s*r-a*n==0)return!1;var c=(n*(o[1]-t[1])+r*(t[0]-o[0]))/(s*r-a*n),h=(s*(t[1]-o[1])+a*(o[0]-t[0]))/(a*n-s*r);return c>=0&&c<=1&&h>=0&&h<=1}},268:function(t,e,o){function i(){this.vertices=[]}function n(t,e,o,i,n){n=n||0;var r=e[1]-t[1],s=t[0]-e[0],c=r*t[0]+s*t[1],h=i[1]-o[1],p=o[0]-i[0],l=h*o[0]+p*o[1],u=r*p-h*s;return a.eq(u,0,n)?[0,0]:[(p*c-s*l)/u,(r*l-h*c)/u]}var r=o(267),s=o(142),a=o(143);t.exports=i,i.prototype.at=function(t){var e=this.vertices,o=e.length;return e[t<0?t%o+o:t%o]},i.prototype.first=function(){return this.vertices[0]},i.prototype.last=function(){return this.vertices[this.vertices.length-1]},i.prototype.clear=function(){this.vertices.length=0},i.prototype.append=function(t,e,o){if("undefined"==typeof e)throw new Error("From is not given!");if("undefined"==typeof o)throw new Error("To is not given!");if(o-1<e)throw new Error("lol1");if(o>t.vertices.length)throw new Error("lol2");if(e<0)throw new Error("lol3");for(var i=e;i<o;i++)this.vertices.push(t.vertices[i])},i.prototype.makeCCW=function(){for(var t=0,e=this.vertices,o=1;o<this.vertices.length;++o)(e[o][1]<e[t][1]||e[o][1]==e[t][1]&&e[o][0]>e[t][0])&&(t=o);s.left(this.at(t-1),this.at(t),this.at(t+1))||this.reverse()},i.prototype.reverse=function(){for(var t=[],e=0,o=this.vertices.length;e!==o;e++)t.push(this.vertices.pop());this.vertices=t},i.prototype.isReflex=function(t){return s.right(this.at(t-1),this.at(t),this.at(t+1))};var c=[],h=[];i.prototype.canSee=function(t,e){var o,i,n=c,a=h;if(s.leftOn(this.at(t+1),this.at(t),this.at(e))&&s.rightOn(this.at(t-1),this.at(t),this.at(e)))return!1;i=s.sqdist(this.at(t),this.at(e));for(var p=0;p!==this.vertices.length;++p)if((p+1)%this.vertices.length!==t&&p!==t&&s.leftOn(this.at(t),this.at(e),this.at(p+1))&&s.rightOn(this.at(t),this.at(e),this.at(p))&&(n[0]=this.at(t),n[1]=this.at(e),a[0]=this.at(p),a[1]=this.at(p+1),o=r.lineInt(n,a),s.sqdist(this.at(t),o)<i))return!1;return!0},i.prototype.copy=function(t,e,o){var n=o||new i;if(n.clear(),t<e)for(var r=t;r<=e;r++)n.vertices.push(this.vertices[r]);else{for(var r=0;r<=e;r++)n.vertices.push(this.vertices[r]);for(var r=t;r<this.vertices.length;r++)n.vertices.push(this.vertices[r])}return n},i.prototype.getCutEdges=function(){for(var t=[],e=[],o=[],n=new i,r=Number.MAX_VALUE,s=0;s<this.vertices.length;++s)if(this.isReflex(s))for(var a=0;a<this.vertices.length;++a)if(this.canSee(s,a)){e=this.copy(s,a,n).getCutEdges(),o=this.copy(a,s,n).getCutEdges();for(var c=0;c<o.length;c++)e.push(o[c]);e.length<r&&(t=e,r=e.length,t.push([this.at(s),this.at(a)]))}return t},i.prototype.decomp=function(){var t=this.getCutEdges();return t.length>0?this.slice(t):[this]},i.prototype.slice=function(t){if(0==t.length)return[this];if(t instanceof Array&&t.length&&t[0]instanceof Array&&2==t[0].length&&t[0][0]instanceof Array){for(var e=[this],o=0;o<t.length;o++)for(var i=t[o],n=0;n<e.length;n++){var r=e[n],s=r.slice(i);if(s){e.splice(n,1),e.push(s[0],s[1]);break}}return e}var i=t,o=this.vertices.indexOf(i[0]),n=this.vertices.indexOf(i[1]);return o!=-1&&n!=-1&&[this.copy(o,n),this.copy(n,o)]},i.prototype.isSimple=function(){for(var t=this.vertices,e=0;e<t.length-1;e++)for(var o=0;o<e-1;o++)if(r.segmentsIntersect(t[e],t[e+1],t[o],t[o+1]))return!1;for(var e=1;e<t.length-2;e++)if(r.segmentsIntersect(t[0],t[t.length-1],t[e],t[e+1]))return!1;return!0},i.prototype.quickDecomp=function(t,e,o,r,a,c){a=a||100,c=c||0,r=r||25,t="undefined"!=typeof t?t:[],e=e||[],o=o||[];var h=[0,0],p=[0,0],l=[0,0],u=0,d=0,f=0,v=0,y=0,m=0,g=0,A=new i,b=new i,E=this,B=this.vertices;if(B.length<3)return t;if(c++,c>a)return console.warn("quickDecomp: max level ("+a+") reached."),t;for(var w=0;w<this.vertices.length;++w)if(E.isReflex(w)){e.push(E.vertices[w]),u=d=Number.MAX_VALUE;for(var P=0;P<this.vertices.length;++P)s.left(E.at(w-1),E.at(w),E.at(P))&&s.rightOn(E.at(w-1),E.at(w),E.at(P-1))&&(l=n(E.at(w-1),E.at(w),E.at(P),E.at(P-1)),s.right(E.at(w+1),E.at(w),l)&&(f=s.sqdist(E.vertices[w],l),f<d&&(d=f,p=l,m=P))),s.left(E.at(w+1),E.at(w),E.at(P+1))&&s.rightOn(E.at(w+1),E.at(w),E.at(P))&&(l=n(E.at(w+1),E.at(w),E.at(P),E.at(P+1)),s.left(E.at(w-1),E.at(w),l)&&(f=s.sqdist(E.vertices[w],l),f<u&&(u=f,h=l,y=P)));if(m==(y+1)%this.vertices.length)l[0]=(p[0]+h[0])/2,l[1]=(p[1]+h[1])/2,o.push(l),w<y?(A.append(E,w,y+1),A.vertices.push(l),b.vertices.push(l),0!=m&&b.append(E,m,E.vertices.length),b.append(E,0,w+1)):(0!=w&&A.append(E,w,E.vertices.length),A.append(E,0,y+1),A.vertices.push(l),b.vertices.push(l),b.append(E,m,w+1));else{if(m>y&&(y+=this.vertices.length),v=Number.MAX_VALUE,y<m)return t;for(var P=m;P<=y;++P)s.leftOn(E.at(w-1),E.at(w),E.at(P))&&s.rightOn(E.at(w+1),E.at(w),E.at(P))&&(f=s.sqdist(E.at(w),E.at(P)),f<v&&(v=f,g=P%this.vertices.length));w<g?(A.append(E,w,g+1),0!=g&&b.append(E,g,B.length),b.append(E,0,w+1)):(0!=w&&A.append(E,w,B.length),A.append(E,0,g+1),b.append(E,g,w+1))}return A.vertices.length<b.vertices.length?(A.quickDecomp(t,e,o,r,a,c),b.quickDecomp(t,e,o,r,a,c)):(b.quickDecomp(t,e,o,r,a,c),A.quickDecomp(t,e,o,r,a,c)),t}return t.push(this),t},i.prototype.removeCollinearPoints=function(t){for(var e=0,o=this.vertices.length-1;this.vertices.length>3&&o>=0;--o)s.collinear(this.at(o-1),this.at(o),this.at(o+1),t)&&(this.vertices.splice(o%this.vertices.length,1),o--,e++);return e}},28:function(t,e,o){function i(t){this.lowerBound=n.create(),t&&t.lowerBound&&n.copy(this.lowerBound,t.lowerBound),this.upperBound=n.create(),t&&t.upperBound&&n.copy(this.upperBound,t.upperBound)}var n=o(0);o(5);t.exports=i;var r=n.create();i.prototype.setFromPoints=function(t,e,o,i){var s=this.lowerBound,a=this.upperBound;"number"!=typeof o&&(o=0),0!==o?n.rotate(s,t[0],o):n.copy(s,t[0]),n.copy(a,s);for(var c=Math.cos(o),h=Math.sin(o),p=1;p<t.length;p++){var l=t[p];if(0!==o){var u=l[0],d=l[1];r[0]=c*u-h*d,r[1]=h*u+c*d,l=r}for(var f=0;f<2;f++)l[f]>a[f]&&(a[f]=l[f]),l[f]<s[f]&&(s[f]=l[f])}e&&(n.add(this.lowerBound,this.lowerBound,e),n.add(this.upperBound,this.upperBound,e)),i&&(this.lowerBound[0]-=i,this.lowerBound[1]-=i,this.upperBound[0]+=i,this.upperBound[1]+=i)},i.prototype.copy=function(t){n.copy(this.lowerBound,t.lowerBound),n.copy(this.upperBound,t.upperBound)},i.prototype.extend=function(t){for(var e=2;e--;){var o=t.lowerBound[e];this.lowerBound[e]>o&&(this.lowerBound[e]=o);var i=t.upperBound[e];this.upperBound[e]<i&&(this.upperBound[e]=i)}},i.prototype.overlaps=function(t){var e=this.lowerBound,o=this.upperBound,i=t.lowerBound,n=t.upperBound;return(i[0]<=o[0]&&o[0]<=n[0]||e[0]<=n[0]&&n[0]<=o[0])&&(i[1]<=o[1]&&o[1]<=n[1]||e[1]<=n[1]&&n[1]<=o[1])},i.prototype.containsPoint=function(t){var e=this.lowerBound,o=this.upperBound;return e[0]<=t[0]&&t[0]<=o[0]&&e[1]<=t[1]&&t[1]<=o[1]},i.prototype.overlapsRay=function(t){var e=1/t.direction[0],o=1/t.direction[1],i=(this.lowerBound[0]-t.from[0])*e,n=(this.upperBound[0]-t.from[0])*e,r=(this.lowerBound[1]-t.from[1])*o,s=(this.upperBound[1]-t.from[1])*o,a=Math.max(Math.max(Math.min(i,n),Math.min(r,s))),c=Math.min(Math.min(Math.max(i,n),Math.max(r,s)));return c<0?-1:a>c?-1:a}},289:function(t,e,o){t.exports=o},29:function(t,e,o){function i(t){this.type=t,this.result=[],this.world=null,this.boundingVolumeType=i.AABB}var n=o(0),r=o(15);t.exports=i,i.AABB=1,i.BOUNDING_CIRCLE=2,i.prototype.setWorld=function(t){this.world=t},i.prototype.getCollisionPairs=function(t){};var s=n.create();i.boundingRadiusCheck=function(t,e){n.sub(s,t.position,e.position);var o=n.squaredLength(s),i=t.boundingRadius+e.boundingRadius;return o<=i*i},i.aabbCheck=function(t,e){return t.getAABB().overlaps(e.getAABB())},i.prototype.boundingVolumeCheck=function(t,e){var o;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:o=i.boundingRadiusCheck(t,e);break;case i.AABB:o=i.aabbCheck(t,e);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return o},i.canCollide=function(t,e){var o=r.KINEMATIC,i=r.STATIC;return(t.type!==i||e.type!==i)&&(!(t.type===o&&e.type===i||t.type===i&&e.type===o)&&((t.type!==o||e.type!==o)&&((t.sleepState!==r.SLEEPING||e.sleepState!==r.SLEEPING)&&!(t.sleepState===r.SLEEPING&&e.type===i||e.sleepState===r.SLEEPING&&t.type===i))))},i.NAIVE=1,i.SAP=2},30:function(t,e,o){function i(t){t=t||{},this.from=t.from?r.fromValues(t.from[0],t.from[1]):r.create(),this.to=t.to?r.fromValues(t.to[0],t.to[1]):r.create(),this.checkCollisionResponse=void 0===t.checkCollisionResponse||t.checkCollisionResponse,this.skipBackfaces=!!t.skipBackfaces,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:-1,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:-1,this.mode=void 0!==t.mode?t.mode:i.ANY,this.callback=t.callback||function(t){},this.direction=r.create(),this.length=1,this.update()}function n(t,e,o){r.sub(a,o,t);var i=r.dot(a,e);return r.scale(c,e,i),r.add(c,c,t),r.squaredDistance(o,c)}t.exports=i;var r=o(0);o(45),o(9),o(28);i.prototype.constructor=i,i.CLOSEST=1,i.ANY=2,i.ALL=4,i.prototype.update=function(){var t=this.direction;r.sub(t,this.to,this.from),this.length=r.length(t),r.normalize(t,t)},i.prototype.intersectBodies=function(t,e){for(var o=0,i=e.length;!t.shouldStop(this)&&o<i;o++){var n=e[o],r=n.getAABB();(r.overlapsRay(this)>=0||r.containsPoint(this.from))&&this.intersectBody(t,n)}};var s=r.create();i.prototype.intersectBody=function(t,e){var o=this.checkCollisionResponse;if(!o||e.collisionResponse)for(var i=s,n=0,a=e.shapes.length;n<a;n++){var c=e.shapes[n];if((!o||c.collisionResponse)&&0!==(this.collisionGroup&c.collisionMask)&&0!==(c.collisionGroup&this.collisionMask)){r.rotate(i,c.position,e.angle),r.add(i,i,e.position);var h=c.angle+e.angle;if(this.intersectShape(t,c,h,i,e),t.shouldStop(this))break}}},i.prototype.intersectShape=function(t,e,o,i,r){var s=this.from,a=n(s,this.direction,i);a>e.boundingRadius*e.boundingRadius||(this._currentBody=r,this._currentShape=e,e.raycast(t,this,i,o),this._currentBody=this._currentShape=null)},i.prototype.getAABB=function(t){var e=this.to,o=this.from;r.set(t.lowerBound,Math.min(e[0],o[0]),Math.min(e[1],o[1])),r.set(t.upperBound,Math.max(e[0],o[0]),Math.max(e[1],o[1]))};r.create();i.prototype.reportIntersection=function(t,e,o,n){var s=(this.from,this.to,this._currentShape),a=this._currentBody;if(!(this.skipBackfaces&&r.dot(o,this.direction)>0))switch(this.mode){case i.ALL:t.set(o,s,a,e,n),this.callback(t);break;case i.CLOSEST:(e<t.fraction||!t.hasHit())&&t.set(o,s,a,e,n);break;case i.ANY:t.set(o,s,a,e,n)}};var a=r.create(),c=r.create()},31:function(t,e,o){function i(t,e){n.call(this,t,e,0,Number.MAX_VALUE),this.contactPointA=r.create(),this.penetrationVec=r.create(),this.contactPointB=r.create(),this.normalA=r.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var n=o(8),r=o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeB=function(t,e,o){var i=this.bodyA,n=this.bodyB,s=this.contactPointA,a=this.contactPointB,c=i.position,h=n.position,p=this.penetrationVec,l=this.normalA,u=this.G,d=r.crossLength(s,l),f=r.crossLength(a,l);u[0]=-l[0],u[1]=-l[1],u[2]=-d,u[3]=l[0],u[4]=l[1],u[5]=f,r.add(p,h,a),r.sub(p,p,c),r.sub(p,p,s);var v,y;this.firstImpact&&0!==this.restitution?(y=0,v=1/e*(1+this.restitution)*this.computeGW()):(y=r.dot(l,p)+this.offset,v=this.computeGW());var m=this.computeGiMf(),g=-y*t-v*e-o*m;return g};var s=r.create(),a=r.create(),c=r.create();i.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(s,this.contactPointA),this.bodyB.getVelocityAtPoint(a,this.contactPointB),r.subtract(c,s,a),r.dot(this.normalA,c)}},32:function(t,e){var o=function(){};t.exports=o,o.prototype={constructor:o,on:function(t,e,o){e.context=o||this,void 0===this._listeners&&(this._listeners={});var i=this._listeners;return void 0===i[t]&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e),this},has:function(t,e){if(void 0===this._listeners)return!1;var o=this._listeners;if(e){if(void 0!==o[t]&&o[t].indexOf(e)!==-1)return!0}else if(void 0!==o[t])return!0;return!1},off:function(t,e){if(void 0===this._listeners)return this;var o=this._listeners,i=o[t].indexOf(e);return i!==-1&&o[t].splice(i,1),this},emit:function(t){if(void 0===this._listeners)return this;var e=this._listeners,o=e[t.type];if(void 0!==o){t.target=this;for(var i=0,n=o.length;i<n;i++){var r=o[i];r.call(r.context,t)}}return this}}},33:function(t,e,o){function i(t){"number"==typeof arguments[0]&&(t={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),t=t||{},this.radius=t.radius||1,t.type=n.CIRCLE,n.call(this,t)}var n=o(9),r=o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){var e=this.radius;return t*e*e/2},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},i.prototype.computeAABB=function(t,e,o){var i=this.radius;r.set(t.upperBound,i,i),r.set(t.lowerBound,-i,-i),e&&(r.add(t.lowerBound,t.lowerBound,e),r.add(t.upperBound,t.upperBound,e))};var s=r.create(),a=r.create();i.prototype.raycast=function(t,e,o,i){var n=e.from,c=e.to,h=this.radius,p=Math.pow(c[0]-n[0],2)+Math.pow(c[1]-n[1],2),l=2*((c[0]-n[0])*(n[0]-o[0])+(c[1]-n[1])*(n[1]-o[1])),u=Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2)-Math.pow(h,2),d=Math.pow(l,2)-4*p*u,f=s,v=a;if(!(d<0))if(0===d)r.lerp(f,n,c,d),r.sub(v,f,o),r.normalize(v,v),e.reportIntersection(t,d,v,-1);else{var y=Math.sqrt(d),m=1/(2*p),g=(-l-y)*m,A=(-l+y)*m;if(g>=0&&g<=1&&(r.lerp(f,n,c,g),r.sub(v,f,o),r.normalize(v,v),e.reportIntersection(t,g,v,-1),t.shouldStop(e)))return;A>=0&&A<=1&&(r.lerp(f,n,c,A),r.sub(v,f,o),r.normalize(v,v),e.reportIntersection(t,A,v,-1))}}},45:function(t,e,o){function i(){this.normal=n.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var n=o(0),r=o(30);t.exports=i,i.prototype.reset=function(){n.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},i.prototype.getHitDistance=function(t){return n.distance(t.from,t.to)*this.fraction},i.prototype.hasHit=function(){return this.fraction!==-1},i.prototype.getHitPoint=function(t,e){n.lerp(t,e.from,e.to,this.fraction)},i.prototype.stop=function(){this.isStopped=!0},i.prototype.shouldStop=function(t){return this.isStopped||this.fraction!==-1&&t.mode===r.ANY},i.prototype.set=function(t,e,o,i,r){n.copy(this.normal,t),this.shape=e,this.body=o,this.fraction=i,this.faceIndex=r}},46:function(t,e){function o(t){this.id=t||o.idCounter++}t.exports=o,o.idCounter=0},47:function(t,e,o){function i(t,e,o){o=n.defaults(o,{stiffness:100,damping:1}),this.stiffness=o.stiffness,this.damping=o.damping,this.bodyA=t,this.bodyB=e}var n=(o(0),o(5));t.exports=i,i.prototype.applyForce=function(){}},48:function(t,e,o){function i(t){t=t||{},t.type=n.PARTICLE,n.call(this,t)}var n=o(9),r=o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=0},i.prototype.computeAABB=function(t,e,o){r.copy(t.lowerBound,e),r.copy(t.upperBound,e)}},49:function(t,e,o){function i(t){t=t||{},t.type=n.PLANE,n.call(this,t)}var n=o(9),r=o(0);o(5);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){return 0},i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},i.prototype.computeAABB=function(t,e,o){var i=o%(2*Math.PI),n=r.set,s=1e7,a=t.lowerBound,c=t.upperBound;n(a,-s,-s),n(c,s,s),0===i?c[1]=0:i===Math.PI/2?a[0]=0:i===Math.PI?a[1]=0:i===3*Math.PI/2&&(c[0]=0)},i.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var s=r.create(),a=(r.create(),r.create(),r.create()),c=r.create();i.prototype.raycast=function(t,e,o,i){var n=e.from,h=e.to,p=e.direction,l=s,u=a,d=c;r.set(u,0,1),r.rotate(u,u,i),r.sub(d,n,o);var f=r.dot(d,u);r.sub(d,h,o);var v=r.dot(d,u);if(!(f*v>0||r.squaredDistance(n,h)<f*f)){var y=r.dot(u,p);r.sub(l,n,o);var m=-r.dot(u,l)/y/e.length;e.reportIntersection(t,m,u,-1)}}},5:function(t,e){function o(){}t.exports=o,o.appendArray=function(t,e){if(e.length<15e4)t.push.apply(t,e);else for(var o=0,i=e.length;o!==i;++o)t.push(e[o])},o.splice=function(t,e,o){o=o||1;for(var i=e,n=t.length-o;i<n;i++)t[i]=t[i+o];t.length=n},"undefined"!=typeof P2_ARRAY_TYPE?o.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?o.ARRAY_TYPE=Float32Array:o.ARRAY_TYPE=Array,o.extend=function(t,e){for(var o in e)t[o]=e[o]},o.defaults=function(t,e){t=t||{};for(var o in e)o in t||(t[o]=e[o]);return t}},50:function(t,e,o){function i(t,e){t=t||{},n.call(this),this.type=e,this.equations=[],this.equationSortFunction=t.equationSortFunction||!1}var n=(o(5),o(32));t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.solve=function(t,e){throw new Error("Solver.solve should be implemented by subclasses!")};var r={bodies:[]};i.prototype.solveIsland=function(t,e){this.removeAllEquations(),e.equations.length&&(this.addEquations(e.equations),r.bodies.length=0,e.getBodies(r.bodies),r.bodies.length&&this.solve(t,r))},i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},i.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},i.prototype.addEquations=function(t){for(var e=0,o=t.length;e!==o;e++){var i=t[e];i.enabled&&this.equations.push(i)}},i.prototype.removeEquation=function(t){var e=this.equations.indexOf(t);e!==-1&&this.equations.splice(e,1)},i.prototype.removeAllEquations=function(){this.equations.length=0},i.GS=1,i.ISLAND=2},73:function(t,e){t.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},74:function(t,e,o){function i(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new p({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.frictionStiffness=d.DEFAULT_STIFFNESS,this.frictionRelaxation=d.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new u,this.contactSkinSize=.01}function n(t,e){s.set(t.vertices[0],.5*-e.length,-e.radius),s.set(t.vertices[1],.5*e.length,-e.radius),s.set(t.vertices[2],.5*e.length,e.radius),s.set(t.vertices[3],.5*-e.length,e.radius)}function r(t,e,o,i){for(var n=z,r=Y,h=H,p=K,l=t,u=e.vertices,d=null,f=0;f!==u.length+1;f++){var v=u[f%u.length],y=u[(f+1)%u.length];s.rotate(n,v,i),s.rotate(r,y,i),c(n,n,o),c(r,r,o),a(h,n,l),a(p,r,l);var m=s.crossLength(h,p);if(null===d&&(d=m),m*d<=0)return!1;d=m}return!0}var s=o(0),a=s.sub,c=s.add,h=s.dot,p=(o(5),o(91)),l=o(92),u=o(94),d=o(8),f=(o(31),o(19),o(33)),v=o(20),y=o(9),m=(o(15),o(87));t.exports=i;var g=s.fromValues(0,1),A=s.fromValues(0,0),b=s.fromValues(0,0),E=s.fromValues(0,0),B=s.fromValues(0,0),w=s.fromValues(0,0),P=s.fromValues(0,0),q=s.fromValues(0,0),L=s.fromValues(0,0),S=s.fromValues(0,0),x=s.fromValues(0,0),F=s.fromValues(0,0),C=s.fromValues(0,0),M=s.fromValues(0,0),I=s.fromValues(0,0),V=s.fromValues(0,0),R=s.fromValues(0,0),T=s.fromValues(0,0),N=s.fromValues(0,0),O=[],G=s.create(),k=s.create();i.prototype.bodiesOverlap=function(t,e){for(var o=G,i=k,n=0,r=t.shapes.length;n!==r;n++){var s=t.shapes[n];t.toWorldFrame(o,s.position);for(var a=0,c=e.shapes.length;a!==c;a++){var h=e.shapes[a];if(e.toWorldFrame(i,h.position),this[s.type|h.type](t,s,o,s.angle+t.angle,e,h,i,h.angle+e.angle,!0))return!0}}return!1},i.prototype.collidedLastStep=function(t,e){var o=0|t.id,i=0|e.id;return!!this.collidingBodiesLastStep.get(o,i)},i.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var t=this.contactEquations,e=t.length;e--;){var o=t[e],i=o.bodyA.id,n=o.bodyB.id;this.collidingBodiesLastStep.set(i,n,!0)}for(var r=this.contactEquations,s=this.frictionEquations,a=0;a<r.length;a++)this.contactEquationPool.release(r[a]);for(var a=0;a<s.length;a++)this.frictionEquationPool.release(s[a]);this.contactEquations.length=this.frictionEquations.length=0},i.prototype.createContactEquation=function(t,e,o,i){var n=this.contactEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.restitution=this.restitution,n.firstImpact=!this.collidedLastStep(t,e),n.stiffness=this.stiffness,n.relaxation=this.relaxation,n.needsUpdate=!0,n.enabled=this.enabledEquations,n.offset=this.contactSkinSize,n},i.prototype.createFrictionEquation=function(t,e,o,i){var n=this.frictionEquationPool.get();return n.bodyA=t,n.bodyB=e,n.shapeA=o,n.shapeB=i,n.setSlipForce(this.slipForce),n.frictionCoefficient=this.frictionCoefficient,n.relativeVelocity=this.surfaceVelocity,n.enabled=this.enabledEquations,n.needsUpdate=!0,n.stiffness=this.frictionStiffness,n.relaxation=this.frictionRelaxation,n.contactEquations.length=0,n},i.prototype.createFrictionFromContact=function(t){var e=this.createFrictionEquation(t.bodyA,t.bodyB,t.shapeA,t.shapeB);return s.copy(e.contactPointA,t.contactPointA),
s.copy(e.contactPointB,t.contactPointB),s.rotate90cw(e.t,t.normalA),e.contactEquations.push(t),e},i.prototype.createFrictionFromAverage=function(t){var e=this.contactEquations[this.contactEquations.length-1],o=this.createFrictionEquation(e.bodyA,e.bodyB,e.shapeA,e.shapeB),i=e.bodyA;e.bodyB;s.set(o.contactPointA,0,0),s.set(o.contactPointB,0,0),s.set(o.t,0,0);for(var n=0;n!==t;n++)e=this.contactEquations[this.contactEquations.length-1-n],e.bodyA===i?(s.add(o.t,o.t,e.normalA),s.add(o.contactPointA,o.contactPointA,e.contactPointA),s.add(o.contactPointB,o.contactPointB,e.contactPointB)):(s.sub(o.t,o.t,e.normalA),s.add(o.contactPointA,o.contactPointA,e.contactPointB),s.add(o.contactPointB,o.contactPointB,e.contactPointA)),o.contactEquations.push(e);var r=1/t;return s.scale(o.contactPointA,o.contactPointA,r),s.scale(o.contactPointB,o.contactPointB,r),s.normalize(o.t,o.t),s.rotate90cw(o.t,o.t),o},i.prototype[y.LINE|y.CONVEX]=i.prototype.convexLine=function(t,e,o,i,n,r,s,a,c){return!c&&0},i.prototype[y.LINE|y.BOX]=i.prototype.lineBox=function(t,e,o,i,n,r,s,a,c){return!c&&0};var _=new m({width:1,height:1}),U=s.create();i.prototype[y.CAPSULE|y.CONVEX]=i.prototype[y.CAPSULE|y.BOX]=i.prototype.convexCapsule=function(t,e,o,i,r,a,c,h,p){var l=U;s.set(l,a.length/2,0),s.rotate(l,l,h),s.add(l,l,c);var u=this.circleConvex(r,a,l,h,t,e,o,i,p,a.radius);s.set(l,-a.length/2,0),s.rotate(l,l,h),s.add(l,l,c);var d=this.circleConvex(r,a,l,h,t,e,o,i,p,a.radius);if(p&&(u||d))return!0;var f=_;n(f,a);var v=this.convexConvex(t,e,o,i,r,f,c,h,p);return v+u+d},i.prototype[y.CAPSULE|y.LINE]=i.prototype.lineCapsule=function(t,e,o,i,n,r,s,a,c){return!c&&0};var D=s.create(),W=s.create(),X=new m({width:1,height:1});i.prototype[y.CAPSULE|y.CAPSULE]=i.prototype.capsuleCapsule=function(t,e,o,i,r,a,c,h,p){for(var l,u=D,d=W,f=0,v=0;v<2;v++){s.set(u,(0===v?-1:1)*e.length/2,0),s.rotate(u,u,i),s.add(u,u,o);for(var y=0;y<2;y++){s.set(d,(0===y?-1:1)*a.length/2,0),s.rotate(d,d,h),s.add(d,d,c),this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var m=this.circleCircle(t,e,u,i,r,a,d,h,p,e.radius,a.radius);if(this.enableFrictionReduction&&(this.enableFriction=l),p&&m)return!0;f+=m}}this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var g=X;n(g,e);var A=this.convexCapsule(t,g,o,i,r,a,c,h,p);if(this.enableFrictionReduction&&(this.enableFriction=l),p&&A)return!0;if(f+=A,this.enableFrictionReduction){var l=this.enableFriction;this.enableFriction=!1}n(g,a);var b=this.convexCapsule(r,g,c,h,t,e,o,i,p);return this.enableFrictionReduction&&(this.enableFriction=l),!(!p||!b)||(f+=b,this.enableFrictionReduction&&f&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(f)),f)},i.prototype[y.LINE|y.LINE]=i.prototype.lineLine=function(t,e,o,i,n,r,s,a,c){return!c&&0},i.prototype[y.PLANE|y.LINE]=i.prototype.planeLine=function(t,e,o,i,n,r,p,l,u){var d=A,f=b,v=E,y=B,m=w,x=P,F=q,C=L,M=S,I=O,V=0;s.set(d,-r.length/2,0),s.set(f,r.length/2,0),s.rotate(v,d,l),s.rotate(y,f,l),c(v,v,p),c(y,y,p),s.copy(d,v),s.copy(f,y),a(m,f,d),s.normalize(x,m),s.rotate90cw(M,x),s.rotate(C,g,i),I[0]=d,I[1]=f;for(var R=0;R<I.length;R++){var T=I[R];a(F,T,o);var N=h(F,C);if(N<0){if(u)return!0;var G=this.createContactEquation(t,n,e,r);V++,s.copy(G.normalA,C),s.normalize(G.normalA,G.normalA),s.scale(F,C,N),a(G.contactPointA,T,F),a(G.contactPointA,G.contactPointA,t.position),a(G.contactPointB,T,p),c(G.contactPointB,G.contactPointB,p),a(G.contactPointB,G.contactPointB,n.position),this.contactEquations.push(G),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(G))}}return!u&&(this.enableFrictionReduction||V&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(V)),V)},i.prototype[y.PARTICLE|y.CAPSULE]=i.prototype.particleCapsule=function(t,e,o,i,n,r,s,a,c){return this.circleLine(t,e,o,i,n,r,s,a,c,r.radius,0)},i.prototype[y.CIRCLE|y.LINE]=i.prototype.circleLine=function(t,e,o,i,n,r,p,l,u,d,f){var d=d||0,f="undefined"!=typeof f?f:e.radius,v=A,y=b,m=E,g=B,V=w,R=P,T=q,N=L,G=S,k=x,_=F,U=C,D=M,W=I,X=O;s.set(N,-r.length/2,0),s.set(G,r.length/2,0),s.rotate(k,N,l),s.rotate(_,G,l),c(k,k,p),c(_,_,p),s.copy(N,k),s.copy(G,_),a(R,G,N),s.normalize(T,R),s.rotate90cw(V,T),a(U,o,N);var z=h(U,V);a(g,N,p),a(D,o,p);var Y=f+d;if(Math.abs(z)<Y){s.scale(v,V,z),a(m,o,v),s.scale(y,V,h(V,D)),s.normalize(y,y),s.scale(y,y,d),c(m,m,y);var H=h(T,m),K=h(T,N),j=h(T,G);if(H>K&&H<j){if(u)return!0;var Z=this.createContactEquation(t,n,e,r);return s.scale(Z.normalA,v,-1),s.normalize(Z.normalA,Z.normalA),s.scale(Z.contactPointA,Z.normalA,f),c(Z.contactPointA,Z.contactPointA,o),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,m,p),c(Z.contactPointB,Z.contactPointB,p),a(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}X[0]=N,X[1]=G;for(var J=0;J<X.length;J++){var Q=X[J];if(a(U,Q,o),s.squaredLength(U)<Math.pow(Y,2)){if(u)return!0;var Z=this.createContactEquation(t,n,e,r);return s.copy(Z.normalA,U),s.normalize(Z.normalA,Z.normalA),s.scale(Z.contactPointA,Z.normalA,f),c(Z.contactPointA,Z.contactPointA,o),a(Z.contactPointA,Z.contactPointA,t.position),a(Z.contactPointB,Q,p),s.scale(W,Z.normalA,-d),c(Z.contactPointB,Z.contactPointB,W),c(Z.contactPointB,Z.contactPointB,p),a(Z.contactPointB,Z.contactPointB,n.position),this.contactEquations.push(Z),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Z)),1}}return 0},i.prototype[y.CIRCLE|y.CAPSULE]=i.prototype.circleCapsule=function(t,e,o,i,n,r,s,a,c){return this.circleLine(t,e,o,i,n,r,s,a,c,r.radius)},i.prototype[y.CIRCLE|y.CONVEX]=i.prototype[y.CIRCLE|y.BOX]=i.prototype.circleConvex=function(t,e,o,i,n,h,p,l,u,d){for(var d="number"==typeof d?d:e.radius,f=A,v=b,y=E,m=B,g=w,P=x,q=F,L=M,S=I,C=V,T=R,N=!1,O=Number.MAX_VALUE,G=h.vertices,k=0;k!==G.length+1;k++){var _=G[k%G.length],U=G[(k+1)%G.length];if(s.rotate(f,_,l),s.rotate(v,U,l),c(f,f,p),c(v,v,p),a(y,v,f),s.normalize(m,y),s.rotate90cw(g,m),s.scale(S,g,-e.radius),c(S,S,o),r(S,h,p,l)){s.sub(C,f,S);var D=Math.abs(s.dot(C,g));D<O&&(s.copy(T,S),O=D,s.scale(L,g,D),s.add(L,L,S),N=!0)}}if(N){if(u)return!0;var W=this.createContactEquation(t,n,e,h);return s.sub(W.normalA,T,o),s.normalize(W.normalA,W.normalA),s.scale(W.contactPointA,W.normalA,d),c(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,L,p),c(W.contactPointB,W.contactPointB,p),a(W.contactPointB,W.contactPointB,n.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}if(d>0)for(var k=0;k<G.length;k++){var X=G[k];if(s.rotate(q,X,l),c(q,q,p),a(P,q,o),s.squaredLength(P)<Math.pow(d,2)){if(u)return!0;var W=this.createContactEquation(t,n,e,h);return s.copy(W.normalA,P),s.normalize(W.normalA,W.normalA),s.scale(W.contactPointA,W.normalA,d),c(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,q,p),c(W.contactPointB,W.contactPointB,p),a(W.contactPointB,W.contactPointB,n.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}}return 0};var z=s.create(),Y=s.create(),H=s.create(),K=s.create();i.prototype[y.PARTICLE|y.CONVEX]=i.prototype[y.PARTICLE|y.BOX]=i.prototype.particleConvex=function(t,e,o,i,n,p,l,u,d){var f=A,v=b,y=E,m=B,g=w,L=P,S=q,F=x,C=M,I=T,V=N,R=Number.MAX_VALUE,O=!1,G=p.vertices;if(!r(o,p,l,u))return 0;if(d)return!0;for(var k=0;k!==G.length+1;k++){var _=G[k%G.length],U=G[(k+1)%G.length];s.rotate(f,_,u),s.rotate(v,U,u),c(f,f,l),c(v,v,l),a(y,v,f),s.normalize(m,y),s.rotate90cw(g,m),a(F,o,f);h(F,g);a(L,f,l),a(S,o,l),s.sub(I,f,o);var D=Math.abs(s.dot(I,g));D<R&&(R=D,s.scale(C,g,D),s.add(C,C,o),s.copy(V,g),O=!0)}if(O){var W=this.createContactEquation(t,n,e,p);return s.scale(W.normalA,V,-1),s.normalize(W.normalA,W.normalA),s.set(W.contactPointA,0,0),c(W.contactPointA,W.contactPointA,o),a(W.contactPointA,W.contactPointA,t.position),a(W.contactPointB,C,l),c(W.contactPointB,W.contactPointB,l),a(W.contactPointB,W.contactPointB,n.position),this.contactEquations.push(W),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(W)),1}return 0},i.prototype[y.CIRCLE]=i.prototype.circleCircle=function(t,e,o,i,n,r,h,p,l,u,d){var f=A,u=u||e.radius,d=d||r.radius;a(f,o,h);var v=u+d;if(s.squaredLength(f)>Math.pow(v,2))return 0;if(l)return!0;var y=this.createContactEquation(t,n,e,r);return a(y.normalA,h,o),s.normalize(y.normalA,y.normalA),s.scale(y.contactPointA,y.normalA,u),s.scale(y.contactPointB,y.normalA,-d),c(y.contactPointA,y.contactPointA,o),a(y.contactPointA,y.contactPointA,t.position),c(y.contactPointB,y.contactPointB,h),a(y.contactPointB,y.contactPointB,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1},i.prototype[y.PLANE|y.CONVEX]=i.prototype[y.PLANE|y.BOX]=i.prototype.planeConvex=function(t,e,o,i,n,r,p,l,u){var d=A,f=b,v=E,y=0;s.rotate(f,g,i);for(var m=0;m!==r.vertices.length;m++){var B=r.vertices[m];if(s.rotate(d,B,l),c(d,d,p),a(v,d,o),h(v,f)<=0){if(u)return!0;y++;var w=this.createContactEquation(t,n,e,r);a(v,d,o),s.copy(w.normalA,f);var P=h(v,w.normalA);s.scale(v,w.normalA,P),a(w.contactPointB,d,n.position),a(w.contactPointA,d,v),a(w.contactPointA,w.contactPointA,t.position),this.contactEquations.push(w),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}}return this.enableFrictionReduction&&this.enableFriction&&y&&this.frictionEquations.push(this.createFrictionFromAverage(y)),y},i.prototype[y.PARTICLE|y.PLANE]=i.prototype.particlePlane=function(t,e,o,i,n,r,c,p,l){var u=A,d=b;p=p||0,a(u,o,c),s.rotate(d,g,p);var f=h(u,d);if(f>0)return 0;if(l)return!0;var v=this.createContactEquation(n,t,r,e);return s.copy(v.normalA,d),s.scale(u,v.normalA,f),a(v.contactPointA,o,u),a(v.contactPointA,v.contactPointA,n.position),a(v.contactPointB,o,t.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1},i.prototype[y.CIRCLE|y.PARTICLE]=i.prototype.circleParticle=function(t,e,o,i,n,r,h,p,l){var u=A;if(a(u,h,o),s.squaredLength(u)>Math.pow(e.radius,2))return 0;if(l)return!0;var d=this.createContactEquation(t,n,e,r);return s.copy(d.normalA,u),s.normalize(d.normalA,d.normalA),s.scale(d.contactPointA,d.normalA,e.radius),c(d.contactPointA,d.contactPointA,o),a(d.contactPointA,d.contactPointA,t.position),a(d.contactPointB,h,n.position),this.contactEquations.push(d),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(d)),1};var j=new f({radius:1}),Z=s.create(),J=s.create();s.create();i.prototype[y.PLANE|y.CAPSULE]=i.prototype.planeCapsule=function(t,e,o,i,n,r,a,h,p){var l=Z,u=J,d=j;s.set(l,-r.length/2,0),s.rotate(l,l,h),c(l,l,a),s.set(u,r.length/2,0),s.rotate(u,u,h),c(u,u,a),d.radius=r.radius;var f;this.enableFrictionReduction&&(f=this.enableFriction,this.enableFriction=!1);var v=this.circlePlane(n,d,l,0,t,e,o,i,p),y=this.circlePlane(n,d,u,0,t,e,o,i,p);if(this.enableFrictionReduction&&(this.enableFriction=f),p)return v||y;var m=v+y;return this.enableFrictionReduction&&m&&this.frictionEquations.push(this.createFrictionFromAverage(m)),m},i.prototype[y.CIRCLE|y.PLANE]=i.prototype.circlePlane=function(t,e,o,i,n,r,p,l,u){var d=t,f=e,v=o,y=n,m=p,B=l;B=B||0;var w=A,P=b,q=E;a(w,v,m),s.rotate(P,g,B);var L=h(P,w);if(L>f.radius)return 0;if(u)return!0;var S=this.createContactEquation(y,d,r,e);return s.copy(S.normalA,P),s.scale(S.contactPointB,S.normalA,-f.radius),c(S.contactPointB,S.contactPointB,v),a(S.contactPointB,S.contactPointB,d.position),s.scale(q,S.normalA,L),a(S.contactPointA,w,q),c(S.contactPointA,S.contactPointA,m),a(S.contactPointA,S.contactPointA,y.position),this.contactEquations.push(S),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(S)),1},i.prototype[y.CONVEX]=i.prototype[y.CONVEX|y.BOX]=i.prototype[y.BOX]=i.prototype.convexConvex=function(t,e,o,n,r,p,l,u,d,f){var v=A,y=b,m=E,g=B,P=w,x=q,F=L,C=S,M=0,f="number"==typeof f?f:0,I=i.findSeparatingAxis(e,o,n,p,l,u,v);if(!I)return 0;a(F,l,o),h(v,F)>0&&s.scale(v,v,-1);var V=i.getClosestEdge(e,n,v,!0),R=i.getClosestEdge(p,u,v);if(V===-1||R===-1)return 0;for(var T=0;T<2;T++){var N=V,O=R,G=e,k=p,_=o,U=l,D=n,W=u,X=t,z=r;if(0===T){var Y;Y=N,N=O,O=Y,Y=G,G=k,k=Y,Y=_,_=U,U=Y,Y=D,D=W,W=Y,Y=X,X=z,z=Y}for(var H=O;H<O+2;H++){var K=k.vertices[(H+k.vertices.length)%k.vertices.length];s.rotate(y,K,W),c(y,y,U);for(var j=0,Z=N-1;Z<N+2;Z++){var J=G.vertices[(Z+G.vertices.length)%G.vertices.length],Q=G.vertices[(Z+1+G.vertices.length)%G.vertices.length];s.rotate(m,J,D),s.rotate(g,Q,D),c(m,m,_),c(g,g,_),a(P,g,m),s.rotate90cw(C,P),s.normalize(C,C),a(F,y,m);var $=h(C,F);(Z===N&&$<=f||Z!==N&&$<=0)&&j++}if(j>=3){if(d)return!0;var tt=this.createContactEquation(X,z,G,k);M++;var J=G.vertices[N%G.vertices.length],Q=G.vertices[(N+1)%G.vertices.length];s.rotate(m,J,D),s.rotate(g,Q,D),c(m,m,_),c(g,g,_),a(P,g,m),s.rotate90cw(tt.normalA,P),s.normalize(tt.normalA,tt.normalA),a(F,y,m);var $=h(tt.normalA,F);s.scale(x,tt.normalA,$),a(tt.contactPointA,y,_),a(tt.contactPointA,tt.contactPointA,x),c(tt.contactPointA,tt.contactPointA,_),a(tt.contactPointA,tt.contactPointA,X.position),a(tt.contactPointB,y,U),c(tt.contactPointB,tt.contactPointB,U),a(tt.contactPointB,tt.contactPointB,z.position),this.contactEquations.push(tt),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(tt))}}}return this.enableFrictionReduction&&this.enableFriction&&M&&this.frictionEquations.push(this.createFrictionFromAverage(M)),M};var Q=s.fromValues(0,0);i.projectConvexOntoAxis=function(t,e,o,i,n){var r,a,c=null,p=null,l=Q;s.rotate(l,i,-o);for(var u=0;u<t.vertices.length;u++)r=t.vertices[u],a=h(r,l),(null===c||a>c)&&(c=a),(null===p||a<p)&&(p=a);if(p>c){var d=p;p=c,c=d}var f=h(e,i);s.set(n,p+f,c+f)};var $=s.fromValues(0,0),tt=s.fromValues(0,0),et=s.fromValues(0,0),ot=s.fromValues(0,0),it=s.fromValues(0,0),nt=s.fromValues(0,0);i.findSeparatingAxis=function(t,e,o,n,r,c,h){var p=null,l=!1,u=!1,d=$,f=tt,v=et,y=ot,g=it,A=nt;if(t instanceof m&&n instanceof m)for(var b=0;2!==b;b++){var E=t,B=o;1===b&&(E=n,B=c);for(var w=0;2!==w;w++){0===w?s.set(y,0,1):1===w&&s.set(y,1,0),0!==B&&s.rotate(y,y,B),i.projectConvexOntoAxis(t,e,o,y,g),i.projectConvexOntoAxis(n,r,c,y,A);var P=g,q=A,L=!1;g[0]>A[0]&&(q=g,P=A,L=!0);var S=q[0]-P[1];l=S<=0,(null===p||S>p)&&(s.copy(h,y),p=S,u=l)}}else for(var b=0;2!==b;b++){var E=t,B=o;1===b&&(E=n,B=c);for(var w=0;w!==E.vertices.length;w++){s.rotate(f,E.vertices[w],B),s.rotate(v,E.vertices[(w+1)%E.vertices.length],B),a(d,v,f),s.rotate90cw(y,d),s.normalize(y,y),i.projectConvexOntoAxis(t,e,o,y,g),i.projectConvexOntoAxis(n,r,c,y,A);var P=g,q=A,L=!1;g[0]>A[0]&&(q=g,P=A,L=!0);var S=q[0]-P[1];l=S<=0,(null===p||S>p)&&(s.copy(h,y),p=S,u=l)}}return u};var rt=s.fromValues(0,0),st=s.fromValues(0,0),at=s.fromValues(0,0);i.getClosestEdge=function(t,e,o,i){var n=rt,r=st,c=at;s.rotate(n,o,-e),i&&s.scale(n,n,-1);for(var p=-1,l=t.vertices.length,u=-1,d=0;d!==l;d++){a(r,t.vertices[(d+1)%l],t.vertices[d%l]),s.rotate90cw(c,r),s.normalize(c,c);var f=h(c,n);(p===-1||f>u)&&(p=d%l,u=f)}return p};var ct=s.create(),ht=s.create(),pt=s.create(),lt=s.create(),ut=s.create(),dt=s.create(),ft=s.create();i.prototype[y.CIRCLE|y.HEIGHTFIELD]=i.prototype.circleHeightfield=function(t,e,o,i,n,r,h,p,l,u){var d=r.heights,u=u||e.radius,f=r.elementWidth,v=ht,y=ct,m=ut,g=ft,A=dt,b=pt,E=lt,B=Math.floor((o[0]-u-h[0])/f),w=Math.ceil((o[0]+u-h[0])/f);B<0&&(B=0),w>=d.length&&(w=d.length-1);for(var P=d[B],q=d[w],L=B;L<w;L++)d[L]<q&&(q=d[L]),d[L]>P&&(P=d[L]);if(o[1]-u>P)return!l&&0;for(var S=!1,L=B;L<w;L++){s.set(b,L*f,d[L]),s.set(E,(L+1)*f,d[L+1]),s.add(b,b,h),s.add(E,E,h),s.sub(A,E,b),s.rotate(A,A,Math.PI/2),s.normalize(A,A),s.scale(y,A,-u),s.add(y,y,o),s.sub(v,y,b);var x=s.dot(v,A);if(y[0]>=b[0]&&y[0]<E[0]&&x<=0){if(l)return!0;S=!0,s.scale(v,A,-x),s.add(m,y,v),s.copy(g,A);var F=this.createContactEquation(n,t,r,e);s.copy(F.normalA,g),s.scale(F.contactPointB,F.normalA,-u),c(F.contactPointB,F.contactPointB,o),a(F.contactPointB,F.contactPointB,t.position),s.copy(F.contactPointA,m),s.sub(F.contactPointA,F.contactPointA,n.position),this.contactEquations.push(F),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(F))}}if(S=!1,u>0)for(var L=B;L<=w;L++)if(s.set(b,L*f,d[L]),s.add(b,b,h),s.sub(v,o,b),s.squaredLength(v)<Math.pow(u,2)){if(l)return!0;S=!0;var F=this.createContactEquation(n,t,r,e);s.copy(F.normalA,v),s.normalize(F.normalA,F.normalA),s.scale(F.contactPointB,F.normalA,-u),c(F.contactPointB,F.contactPointB,o),a(F.contactPointB,F.contactPointB,t.position),a(F.contactPointA,b,h),c(F.contactPointA,F.contactPointA,h),a(F.contactPointA,F.contactPointA,n.position),this.contactEquations.push(F),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(F))}return S?1:0};var vt=s.create(),yt=s.create(),mt=s.create(),gt=new v({vertices:[s.create(),s.create(),s.create(),s.create()]});i.prototype[y.BOX|y.HEIGHTFIELD]=i.prototype[y.CONVEX|y.HEIGHTFIELD]=i.prototype.convexHeightfield=function(t,e,o,i,n,r,a,c,h){var p=r.heights,l=r.elementWidth,u=vt,d=yt,f=mt,v=gt,y=Math.floor((t.aabb.lowerBound[0]-a[0])/l),m=Math.ceil((t.aabb.upperBound[0]-a[0])/l);y<0&&(y=0),m>=p.length&&(m=p.length-1);for(var g=p[y],A=p[m],b=y;b<m;b++)p[b]<A&&(A=p[b]),p[b]>g&&(g=p[b]);if(t.aabb.lowerBound[1]>g)return!h&&0;for(var E=0,b=y;b<m;b++){s.set(u,b*l,p[b]),s.set(d,(b+1)*l,p[b+1]),s.add(u,u,a),s.add(d,d,a);var B=100;s.set(f,.5*(d[0]+u[0]),.5*(d[1]+u[1]-B)),s.sub(v.vertices[0],d,f),s.sub(v.vertices[1],u,f),s.copy(v.vertices[2],v.vertices[1]),s.copy(v.vertices[3],v.vertices[0]),v.vertices[2][1]-=B,v.vertices[3][1]-=B,E+=this.convexConvex(t,e,o,i,n,v,f,0,h)}return E}},75:function(t,e,o){function i(){r.call(this,r.SAP),this.axisList=[],this.axisIndex=0;var t=this;this._addBodyHandler=function(e){t.axisList.push(e.body)},this._removeBodyHandler=function(e){var o=t.axisList.indexOf(e.body);o!==-1&&t.axisList.splice(o,1)}}var n=o(5),r=o(29);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.setWorld=function(t){this.axisList.length=0,n.appendArray(this.axisList,t.bodies),t.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),t.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=t},i.sortAxisList=function(t,e){e|=0;for(var o=1,i=t.length;o<i;o++){for(var n=t[o],r=o-1;r>=0&&!(t[r].aabb.lowerBound[e]<=n.aabb.lowerBound[e]);r--)t[r+1]=t[r];t[r+1]=n}return t},i.prototype.sortList=function(){var t=this.axisList,e=this.axisIndex;i.sortAxisList(t,e)},i.prototype.getCollisionPairs=function(t){var e=this.axisList,o=this.result,i=this.axisIndex;o.length=0;for(var n=e.length;n--;){var s=e[n];s.aabbNeedsUpdate&&s.updateAABB()}this.sortList();for(var a=0,c=0|e.length;a!==c;a++)for(var h=e[a],p=a+1;p<c;p++){var l=e[p],u=l.aabb.lowerBound[i]<=h.aabb.upperBound[i];if(!u)break;r.canCollide(h,l)&&this.boundingVolumeCheck(h,l)&&o.push(h,l)}return o},i.prototype.aabbQuery=function(t,e,o){o=o||[],this.sortList();var i=this.axisIndex,n="x";1===i&&(n="y"),2===i&&(n="z");for(var r=this.axisList,s=(e.lowerBound[n],e.upperBound[n],0);s<r.length;s++){var a=r[s];a.aabbNeedsUpdate&&a.updateAABB(),a.aabb.overlaps(e)&&o.push(a)}return o}},76:function(t,e,o){function i(t,e,o){o=a.defaults(o,{localAnchorA:[0,0],localAnchorB:[0,0]}),n.call(this,t,e,n.DISTANCE,o),this.localAnchorA=s.fromValues(o.localAnchorA[0],o.localAnchorA[1]),this.localAnchorB=s.fromValues(o.localAnchorB[0],o.localAnchorB[1]);var i=this.localAnchorA,c=this.localAnchorB;if(this.distance=0,"number"==typeof o.distance)this.distance=o.distance;else{var h=s.create(),p=s.create(),l=s.create();s.rotate(h,i,t.angle),s.rotate(p,c,e.angle),s.add(l,e.position,p),s.sub(l,l,h),s.sub(l,l,t.position),this.distance=s.length(l)}var u;u="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce;var d=new r(t,e,-u,u);this.equations=[d],this.maxForce=u;var l=s.create(),f=s.create(),v=s.create(),y=this;d.computeGq=function(){var t=this.bodyA,e=this.bodyB,o=t.position,n=e.position;return s.rotate(f,i,t.angle),s.rotate(v,c,e.angle),s.add(l,n,v),s.sub(l,l,f),s.sub(l,l,o),s.length(l)-y.distance},this.setMaxForce(u),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var n=o(14),r=o(8),s=o(0),a=o(5);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var c=s.create(),h=s.create(),p=s.create();i.prototype.update=function(){var t=this.equations[0],e=this.bodyA,o=this.bodyB,i=(this.distance,e.position),n=o.position,r=this.equations[0],a=t.G;s.rotate(h,this.localAnchorA,e.angle),s.rotate(p,this.localAnchorB,o.angle),s.add(c,n,p),s.sub(c,c,h),s.sub(c,c,i),this.position=s.length(c);var l=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(r.maxForce=0,r.minForce=-this.maxForce,this.distance=this.upperLimit,l=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(r.maxForce=this.maxForce,r.minForce=0,this.distance=this.lowerLimit,l=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!l)return void(r.enabled=!1);r.enabled=!0,s.normalize(c,c);var u=s.crossLength(h,c),d=s.crossLength(p,c);a[0]=-c[0],a[1]=-c[1],a[2]=-u,a[3]=c[0],a[4]=c[1],a[5]=d},i.prototype.setMaxForce=function(t){var e=this.equations[0];e.minForce=-t,e.maxForce=t},i.prototype.getMaxForce=function(){var t=this.equations[0];return t.maxForce}},77:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,n.GEAR,o),this.ratio=void 0!==o.ratio?o.ratio:1,this.angle=void 0!==o.angle?o.angle:e.angle-this.ratio*t.angle,o.angle=this.angle,o.ratio=this.ratio,this.equations=[new r(t,e,o)],void 0!==o.maxTorque&&this.setMaxTorque(o.maxTorque)}var n=o(14),r=(o(8),o(81));o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.update=function(){var t=this.equations[0];t.ratio!==this.ratio&&t.setRatio(this.ratio),t.angle=this.angle},i.prototype.setMaxTorque=function(t){this.equations[0].setMaxTorque(t)},i.prototype.getMaxTorque=function(t){return this.equations[0].maxForce}},78:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,n.LOCK,o);var i="undefined"==typeof o.maxForce?Number.MAX_VALUE:o.maxForce,a=(o.localAngleB||0,new s(t,e,-i,i)),c=new s(t,e,-i,i),h=new s(t,e,-i,i),p=r.create(),l=r.create(),u=this;a.computeGq=function(){return r.rotate(p,u.localOffsetB,t.angle),r.sub(l,e.position,t.position),r.sub(l,l,p),l[0]},c.computeGq=function(){return r.rotate(p,u.localOffsetB,t.angle),r.sub(l,e.position,t.position),r.sub(l,l,p),l[1]};var d=r.create(),f=r.create();h.computeGq=function(){return r.rotate(d,u.localOffsetB,e.angle-u.localAngleB),r.scale(d,d,-1),r.sub(l,t.position,e.position),r.add(l,l,d),r.rotate(f,d,-Math.PI/2),r.normalize(f,f),r.dot(l,f)},this.localOffsetB=r.create(),o.localOffsetB?r.copy(this.localOffsetB,o.localOffsetB):(r.sub(this.localOffsetB,e.position,t.position),r.rotate(this.localOffsetB,this.localOffsetB,-t.angle)),this.localAngleB=0,"number"==typeof o.localAngleB?this.localAngleB=o.localAngleB:this.localAngleB=e.angle-t.angle,this.equations.push(a,c,h),this.setMaxForce(i)}var n=o(14),r=o(0),s=o(8);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.setMaxForce=function(t){for(var e=this.equations,o=0;o<this.equations.length;o++)e[o].maxForce=t,e[o].minForce=-t},i.prototype.getMaxForce=function(){return this.equations[0].maxForce};var a=r.create(),c=r.create(),h=r.create(),p=r.fromValues(1,0),l=r.fromValues(0,1);i.prototype.update=function(){var t=this.equations[0],e=this.equations[1],o=this.equations[2],i=this.bodyA,n=this.bodyB;r.rotate(a,this.localOffsetB,i.angle),r.rotate(c,this.localOffsetB,n.angle-this.localAngleB),r.scale(c,c,-1),r.rotate(h,c,Math.PI/2),r.normalize(h,h),t.G[0]=-1,t.G[1]=0,t.G[2]=-r.crossLength(a,p),t.G[3]=1,e.G[0]=0,e.G[1]=-1,e.G[2]=-r.crossLength(a,l),e.G[4]=1,o.G[0]=-h[0],o.G[1]=-h[1],o.G[3]=h[0],o.G[4]=h[1],o.G[5]=r.crossLength(c,h)}},79:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,n.PRISMATIC,o);var i=a.fromValues(0,0),h=a.fromValues(1,0),p=a.fromValues(0,0);o.localAnchorA&&a.copy(i,o.localAnchorA),o.localAxisA&&a.copy(h,o.localAxisA),o.localAnchorB&&a.copy(p,o.localAnchorB),this.localAnchorA=i,this.localAnchorB=p,this.localAxisA=h;var l=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE,u=new s(t,e,-l,l),d=new a.create,f=new a.create,v=new a.create,y=new a.create;if(u.computeGq=function(){return a.dot(v,y)},u.updateJacobian=function(){var o=this.G,n=t.position,r=e.position;a.rotate(d,i,t.angle),a.rotate(f,p,e.angle),a.add(v,r,f),a.sub(v,v,n),a.sub(v,v,d),a.rotate(y,h,t.angle+Math.PI/2),o[0]=-y[0],o[1]=-y[1],o[2]=-a.crossLength(d,y)+a.crossLength(y,v),o[3]=y[0],o[4]=y[1],o[5]=a.crossLength(f,y)},this.equations.push(u),!o.disableRotationalLock){var m=new c(t,e,-l,l);this.equations.push(m)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof o.lowerLimit,this.upperLimitEnabled="undefined"!=typeof o.upperLimit,this.lowerLimit="undefined"!=typeof o.lowerLimit?o.lowerLimit:0,this.upperLimit="undefined"!=typeof o.upperLimit?o.upperLimit:1,this.upperLimitEquation=new r(t,e),this.lowerLimitEquation=new r(t,e),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=l,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.motorSpeed=0;var g=this,A=this.motorEquation;A.computeGW;A.computeGq=function(){return 0},A.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,s=o.angularVelocity;return this.gmult(t,i,r,n,s)+g.motorSpeed}}var n=o(14),r=o(31),s=o(8),a=o(0),c=o(82);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var h=a.create(),p=a.create(),l=a.create(),u=a.create(),d=a.create(),f=a.create();i.prototype.update=function(){var t=this.equations,e=t[0],o=this.upperLimit,i=this.lowerLimit,n=this.upperLimitEquation,r=this.lowerLimitEquation,s=this.bodyA,c=this.bodyB,v=this.localAxisA,y=this.localAnchorA,m=this.localAnchorB;e.updateJacobian(),a.rotate(h,v,s.angle),a.rotate(u,y,s.angle),a.add(p,u,s.position),a.rotate(d,m,c.angle),a.add(l,d,c.position);var g=this.position=a.dot(l,h)-a.dot(p,h);if(this.motorEnabled){var A=this.motorEquation.G;A[0]=h[0],A[1]=h[1],A[2]=a.crossLength(h,d),A[3]=-h[0],A[4]=-h[1],A[5]=-a.crossLength(h,u)}if(this.upperLimitEnabled&&g>o)a.scale(n.normalA,h,-1),a.sub(n.contactPointA,p,s.position),a.sub(n.contactPointB,l,c.position),a.scale(f,h,o),a.add(n.contactPointA,n.contactPointA,f),t.indexOf(n)===-1&&t.push(n);else{var b=t.indexOf(n);b!==-1&&t.splice(b,1)}if(this.lowerLimitEnabled&&g<i)a.scale(r.normalA,h,1),a.sub(r.contactPointA,p,s.position),a.sub(r.contactPointB,l,c.position),a.scale(f,h,i),a.sub(r.contactPointB,r.contactPointB,f),t.indexOf(r)===-1&&t.push(r);else{var b=t.indexOf(r);b!==-1&&t.splice(b,1)}},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},i.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)}},8:function(t,e,o){function i(t,e,o,n){this.minForce="undefined"==typeof o?-Number.MAX_VALUE:o,this.maxForce="undefined"==typeof n?Number.MAX_VALUE:n,this.bodyA=t,this.bodyB=e,this.stiffness=i.DEFAULT_STIFFNESS,this.relaxation=i.DEFAULT_RELAXATION,this.G=new r.ARRAY_TYPE(6);for(var s=0;s<6;s++)this.G[s]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}t.exports=i;var n=o(0),r=o(5);o(15);i.prototype.constructor=i,i.DEFAULT_STIFFNESS=1e6,i.DEFAULT_RELAXATION=4,i.prototype.update=function(){var t=this.stiffness,e=this.relaxation,o=this.timeStep;this.a=4/(o*(1+4*e)),this.b=4*e/(1+4*e),this.epsilon=4/(o*o*t*(1+4*e)),this.needsUpdate=!1},i.prototype.gmult=function(t,e,o,i,n){return t[0]*e[0]+t[1]*e[1]+t[2]*o+t[3]*i[0]+t[4]*i[1]+t[5]*n},i.prototype.computeB=function(t,e,o){var i=this.computeGW(),n=this.computeGq(),r=this.computeGiMf();return-n*t-i*e-r*o};var s=n.create(),a=n.create();i.prototype.computeGq=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=(e.position,o.position,e.angle),n=o.angle;return this.gmult(t,s,i,a,n)+this.offset},i.prototype.computeGW=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.velocity,n=o.velocity,r=e.angularVelocity,s=o.angularVelocity;return this.gmult(t,i,r,n,s)+this.relativeVelocity},i.prototype.computeGWlambda=function(){var t=this.G,e=this.bodyA,o=this.bodyB,i=e.vlambda,n=o.vlambda,r=e.wlambda,s=o.wlambda;return this.gmult(t,i,r,n,s)};var c=n.create(),h=n.create();i.prototype.computeGiMf=function(){var t=this.bodyA,e=this.bodyB,o=t.force,i=t.angularForce,r=e.force,s=e.angularForce,a=t.invMassSolve,p=e.invMassSolve,l=t.invInertiaSolve,u=e.invInertiaSolve,d=this.G;return n.scale(c,o,a),n.multiply(c,t.massMultiplier,c),n.scale(h,r,p),n.multiply(h,e.massMultiplier,h),this.gmult(d,c,i*l,h,s*u)},i.prototype.computeGiMGt=function(){var t=this.bodyA,e=this.bodyB,o=t.invMassSolve,i=e.invMassSolve,n=t.invInertiaSolve,r=e.invInertiaSolve,s=this.G;return s[0]*s[0]*o*t.massMultiplier[0]+s[1]*s[1]*o*t.massMultiplier[1]+s[2]*s[2]*n+s[3]*s[3]*i*e.massMultiplier[0]+s[4]*s[4]*i*e.massMultiplier[1]+s[5]*s[5]*r};var p=n.create(),l=n.create(),u=n.create();n.create(),n.create(),n.create();i.prototype.addToWlambda=function(t){var e=this.bodyA,o=this.bodyB,i=p,r=l,s=u,a=e.invMassSolve,c=o.invMassSolve,h=e.invInertiaSolve,d=o.invInertiaSolve,f=this.G;r[0]=f[0],r[1]=f[1],s[0]=f[3],s[1]=f[4],n.scale(i,r,a*t),n.multiply(i,i,e.massMultiplier),n.add(e.vlambda,e.vlambda,i),e.wlambda+=h*f[2]*t,n.scale(i,s,c*t),n.multiply(i,i,o.massMultiplier),n.add(o.vlambda,o.vlambda,i),o.wlambda+=d*f[5]*t},i.prototype.computeInvC=function(t){return 1/(this.computeGiMGt()+t)}},80:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,n.REVOLUTE,o);var i=this.maxForce="undefined"!=typeof o.maxForce?o.maxForce:Number.MAX_VALUE;this.pivotA=c.create(),this.pivotB=c.create(),o.worldPivot?(c.sub(this.pivotA,o.worldPivot,t.position),c.sub(this.pivotB,o.worldPivot,e.position),c.rotate(this.pivotA,this.pivotA,-t.angle),c.rotate(this.pivotB,this.pivotB,-e.angle)):(c.copy(this.pivotA,o.localPivotA),c.copy(this.pivotB,o.localPivotB));var f=this.equations=[new r(t,e,-i,i),new r(t,e,-i,i)],v=f[0],y=f[1],m=this;v.computeGq=function(){return c.rotate(h,m.pivotA,t.angle),c.rotate(p,m.pivotB,e.angle),c.add(d,e.position,p),c.sub(d,d,t.position),c.sub(d,d,h),c.dot(d,l)},y.computeGq=function(){return c.rotate(h,m.pivotA,t.angle),c.rotate(p,m.pivotB,e.angle),c.add(d,e.position,p),c.sub(d,d,t.position),c.sub(d,d,h),c.dot(d,u)},y.minForce=v.minForce=-i,y.maxForce=v.maxForce=i,this.motorEquation=new s(t,e),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new a(t,e),this.lowerLimitEquation=new a(t,e),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var n=o(14),r=o(8),s=o(83),a=o(82),c=o(0);t.exports=i;var h=c.create(),p=c.create(),l=c.fromValues(1,0),u=c.fromValues(0,1),d=c.create();i.prototype=new n,i.prototype.constructor=i,i.prototype.setLimits=function(t,e){"number"==typeof t?(this.lowerLimit=t,this.lowerLimitEnabled=!0):(this.lowerLimit=t,this.lowerLimitEnabled=!1),"number"==typeof e?(this.upperLimit=e,this.upperLimitEnabled=!0):(this.upperLimit=e,this.upperLimitEnabled=!1)},i.prototype.update=function(){
var t=this.bodyA,e=this.bodyB,o=this.pivotA,i=this.pivotB,n=this.equations,r=(n[0],n[1],n[0]),s=n[1],a=this.upperLimit,d=this.lowerLimit,f=this.upperLimitEquation,v=this.lowerLimitEquation,y=this.angle=e.angle-t.angle;if(this.upperLimitEnabled&&y>a)f.angle=a,n.indexOf(f)===-1&&n.push(f);else{var m=n.indexOf(f);m!==-1&&n.splice(m,1)}if(this.lowerLimitEnabled&&y<d)v.angle=d,n.indexOf(v)===-1&&n.push(v);else{var m=n.indexOf(v);m!==-1&&n.splice(m,1)}c.rotate(h,o,t.angle),c.rotate(p,i,e.angle),r.G[0]=-1,r.G[1]=0,r.G[2]=-c.crossLength(h,l),r.G[3]=1,r.G[4]=0,r.G[5]=c.crossLength(p,l),s.G[0]=0,s.G[1]=-1,s.G[2]=-c.crossLength(h,u),s.G[3]=0,s.G[4]=1,s.G[5]=c.crossLength(p,u)},i.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},i.prototype.disableMotor=function(){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations.splice(t,1),this.motorEnabled=!1}},i.prototype.motorIsEnabled=function(){return!!this.motorEnabled},i.prototype.setMotorSpeed=function(t){if(this.motorEnabled){var e=this.equations.indexOf(this.motorEquation);this.equations[e].relativeVelocity=t}},i.prototype.getMotorSpeed=function(){return!!this.motorEnabled&&this.motorEquation.relativeVelocity}},81:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0,this.ratio="number"==typeof o.ratio?o.ratio:1,this.setRatio(this.ratio)}var n=o(8);o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},i.prototype.setRatio=function(t){var e=this.G;e[2]=t,e[5]=-1,this.ratio=t},i.prototype.setMaxTorque=function(t){this.maxForce=t,this.minForce=-t}},82:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=o.angle||0;var i=this.G;i[2]=1,i[5]=-1}var n=o(8),r=o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i;var s=r.create(),a=r.create(),c=r.fromValues(1,0),h=r.fromValues(0,1);i.prototype.computeGq=function(){return r.rotate(s,c,this.bodyA.angle+this.angle),r.rotate(a,h,this.bodyB.angle),r.dot(s,a)}},83:function(t,e,o){function i(t,e){n.call(this,t,e,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var n=o(8);o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeB=function(t,e,o){var i=this.G;i[2]=-1,i[5]=this.ratio;var n=this.computeGiMf(),r=this.computeGW(),s=-r*e-o*n;return s}},84:function(t,e,o){function i(t,e,o){if(o=o||{},!(t instanceof n&&e instanceof n))throw new Error("First two arguments must be Material instances.");this.id=i.idCounter++,this.materialA=t,this.materialB=e,this.friction="undefined"!=typeof o.friction?Number(o.friction):.3,this.restitution="undefined"!=typeof o.restitution?Number(o.restitution):0,this.stiffness="undefined"!=typeof o.stiffness?Number(o.stiffness):r.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof o.relaxation?Number(o.relaxation):r.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof o.frictionStiffness?Number(o.frictionStiffness):r.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof o.frictionRelaxation?Number(o.frictionRelaxation):r.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof o.surfaceVelocity?Number(o.surfaceVelocity):0,this.contactSkinSize=.005}var n=o(46),r=o(8);t.exports=i,i.idCounter=0},85:function(t,e,o){function i(t,e,o){o=o||{},r.call(this,t,e,o),this.localAnchorA=n.fromValues(0,0),this.localAnchorB=n.fromValues(0,0),o.localAnchorA&&n.copy(this.localAnchorA,o.localAnchorA),o.localAnchorB&&n.copy(this.localAnchorB,o.localAnchorB),o.worldAnchorA&&this.setWorldAnchorA(o.worldAnchorA),o.worldAnchorB&&this.setWorldAnchorB(o.worldAnchorB);var i=n.create(),s=n.create();this.getWorldAnchorA(i),this.getWorldAnchorB(s);var a=n.distance(i,s);this.restLength="number"==typeof o.restLength?o.restLength:a}var n=o(0),r=o(47);o(5);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.setWorldAnchorA=function(t){this.bodyA.toLocalFrame(this.localAnchorA,t)},i.prototype.setWorldAnchorB=function(t){this.bodyB.toLocalFrame(this.localAnchorB,t)},i.prototype.getWorldAnchorA=function(t){this.bodyA.toWorldFrame(t,this.localAnchorA)},i.prototype.getWorldAnchorB=function(t){this.bodyB.toWorldFrame(t,this.localAnchorB)};var s=n.create(),a=n.create(),c=n.create(),h=n.create(),p=n.create(),l=n.create(),u=n.create(),d=n.create(),f=n.create();i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restLength,i=this.bodyA,r=this.bodyB,v=s,y=a,m=c,g=h,A=f,b=p,E=l,B=u,w=d;this.getWorldAnchorA(b),this.getWorldAnchorB(E),n.sub(B,b,i.position),n.sub(w,E,r.position),n.sub(v,E,b);var P=n.len(v);n.normalize(y,v),n.sub(m,r.velocity,i.velocity),n.crossZV(A,r.angularVelocity,w),n.add(m,m,A),n.crossZV(A,i.angularVelocity,B),n.sub(m,m,A),n.scale(g,y,-t*(P-o)-e*n.dot(m,y)),n.sub(i.force,i.force,g),n.add(r.force,r.force,g);var q=n.crossLength(B,g),L=n.crossLength(w,g);i.angularForce-=q,r.angularForce+=L}},86:function(t,e,o){function i(t,e,o){o=o||{},n.call(this,t,e,o),this.restAngle="number"==typeof o.restAngle?o.restAngle:e.angle-t.angle}var n=(o(0),o(47));t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,o=this.restAngle,i=this.bodyA,n=this.bodyB,r=n.angle-i.angle,s=n.angularVelocity-i.angularVelocity,a=-t*(r-o)-e*s*0;i.angularForce-=a,n.angularForce+=a}},87:function(t,e,o){function i(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),t=t||{};var e=this.width=t.width||1,o=this.height=t.height||1,i=[n.fromValues(-e/2,-o/2),n.fromValues(e/2,-o/2),n.fromValues(e/2,o/2),n.fromValues(-e/2,o/2)],a=[n.fromValues(1,0),n.fromValues(0,1)];t.vertices=i,t.axes=a,t.type=r.BOX,s.call(this,t)}var n=o(0),r=o(9),s=o(20);t.exports=i,i.prototype=new s,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){var e=this.width,o=this.height;return t*(o*o+e*e)/12},i.prototype.updateBoundingRadius=function(){var t=this.width,e=this.height;this.boundingRadius=Math.sqrt(t*t+e*e)/2};n.create(),n.create(),n.create(),n.create();i.prototype.computeAABB=function(t,e,o){t.setFromPoints(this.vertices,e,o,0)},i.prototype.updateArea=function(){this.area=this.width*this.height}},88:function(t,e,o){function i(t){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(t={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),t=t||{},this.length=t.length||1,this.radius=t.radius||1,t.type=n.CAPSULE,n.call(this,t)}var n=o(9),r=o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){var e=this.radius,o=this.length+e,i=2*e;return t*(i*i+o*o)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var s=r.create();i.prototype.computeAABB=function(t,e,o){var i=this.radius;r.set(s,this.length/2,0),0!==o&&r.rotate(s,s,o),r.set(t.upperBound,Math.max(s[0]+i,-s[0]+i),Math.max(s[1]+i,-s[1]+i)),r.set(t.lowerBound,Math.min(s[0]-i,-s[0]-i),Math.min(s[1]-i,-s[1]-i)),r.add(t.lowerBound,t.lowerBound,e),r.add(t.upperBound,t.upperBound,e)};var a=r.create(),c=r.create(),h=r.create(),p=r.create(),l=r.fromValues(0,1);i.prototype.raycast=function(t,e,o,i){for(var n=e.from,s=e.to,u=(e.direction,a),d=c,f=h,v=p,y=this.length/2,m=0;m<2;m++){var g=this.radius*(2*m-1);r.set(f,-y,g),r.set(v,y,g),r.toGlobalFrame(f,f,o,i),r.toGlobalFrame(v,v,o,i);var A=r.getLineSegmentsIntersectionFraction(n,s,f,v);if(A>=0&&(r.rotate(d,l,i),r.scale(d,d,2*m-1),e.reportIntersection(t,A,d,-1),t.shouldStop(e)))return}for(var b=Math.pow(this.radius,2)+Math.pow(y,2),m=0;m<2;m++){r.set(f,y*(2*m-1),0),r.toGlobalFrame(f,f,o,i);var E=Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2),B=2*((s[0]-n[0])*(n[0]-f[0])+(s[1]-n[1])*(n[1]-f[1])),w=Math.pow(n[0]-f[0],2)+Math.pow(n[1]-f[1],2)-Math.pow(this.radius,2),A=Math.pow(B,2)-4*E*w;if(!(A<0))if(0===A){if(r.lerp(u,n,s,A),r.squaredDistance(u,o)>b&&(r.sub(d,u,f),r.normalize(d,d),e.reportIntersection(t,A,d,-1),t.shouldStop(e)))return}else{var P=Math.sqrt(A),q=1/(2*E),L=(-B-P)*q,S=(-B+P)*q;if(L>=0&&L<=1&&(r.lerp(u,n,s,L),r.squaredDistance(u,o)>b&&(r.sub(d,u,f),r.normalize(d,d),e.reportIntersection(t,L,d,-1),t.shouldStop(e))))return;if(S>=0&&S<=1&&(r.lerp(u,n,s,S),r.squaredDistance(u,o)>b&&(r.sub(d,u,f),r.normalize(d,d),e.reportIntersection(t,S,d,-1),t.shouldStop(e))))return}}}},89:function(t,e,o){function i(t){"number"==typeof arguments[0]&&(t={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),t=t||{},this.length=t.length||1,t.type=n.LINE,n.call(this,t)}var n=o(9),r=o(0);t.exports=i,i.prototype=new n,i.prototype.constructor=i,i.prototype.computeMomentOfInertia=function(t){return t*Math.pow(this.length,2)/12},i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var s=[r.create(),r.create()];i.prototype.computeAABB=function(t,e,o){var i=this.length/2;r.set(s[0],-i,0),r.set(s[1],i,0),t.setFromPoints(s,e,o,0)};var a=(r.create(),r.create()),c=r.create(),h=r.create(),p=r.fromValues(0,1);i.prototype.raycast=function(t,e,o,i){var n=e.from,s=e.to,l=c,u=h,d=this.length/2;r.set(l,-d,0),r.set(u,d,0),r.toGlobalFrame(l,l,o,i),r.toGlobalFrame(u,u,o,i);var f=r.getLineSegmentsIntersectionFraction(l,u,n,s);if(f>=0){var v=a;r.rotate(v,p,i),e.reportIntersection(t,f,v,-1)}}},9:function(t,e,o){function i(t){t=t||{},this.body=null,this.position=n.fromValues(0,0),t.position&&n.copy(this.position,t.position),this.angle=t.angle||0,this.type=t.type||0,this.id=i.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==t.collisionGroup?t.collisionGroup:1,this.collisionResponse=void 0===t.collisionResponse||t.collisionResponse,this.collisionMask=void 0!==t.collisionMask?t.collisionMask:1,this.material=t.material||null,this.area=0,this.sensor=void 0!==t.sensor&&t.sensor,this.type&&this.updateBoundingRadius(),this.updateArea()}t.exports=i;var n=o(0);i.idCounter=0,i.CIRCLE=1,i.PARTICLE=2,i.PLANE=4,i.CONVEX=8,i.LINE=16,i.BOX=32,Object.defineProperty(i,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),i.BOX}}),i.CAPSULE=64,i.HEIGHTFIELD=128,i.prototype.computeMomentOfInertia=function(t){},i.prototype.updateBoundingRadius=function(){},i.prototype.updateArea=function(){},i.prototype.computeAABB=function(t,e,o){},i.prototype.raycast=function(t,e,o,i){}},90:function(t,e,o){function i(t){s.call(this,t,s.GS),t=t||{},this.iterations=t.iterations||10,this.tolerance=t.tolerance||1e-7,this.arrayStep=30,this.lambda=new a.ARRAY_TYPE(this.arrayStep),this.Bs=new a.ARRAY_TYPE(this.arrayStep),this.invCs=new a.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==t.frictionIterations?0:t.frictionIterations,this.usedIterations=0}function n(t){for(var e=t.length;e--;)t[e]=0}var r=o(0),s=o(50),a=o(5),c=o(19);t.exports=i,i.prototype=new s,i.prototype.constructor=i,i.prototype.solve=function(t,e){this.sortEquations();var o=0,s=this.iterations,h=this.frictionIterations,p=this.equations,l=p.length,u=Math.pow(this.tolerance*l,2),d=e.bodies,f=e.bodies.length,v=(r.add,r.set,this.useZeroRHS),y=this.lambda;if(this.usedIterations=0,l)for(var m=0;m!==f;m++){var g=d[m];g.updateSolveMassProperties()}y.length<l&&(y=this.lambda=new a.ARRAY_TYPE(l+this.arrayStep),this.Bs=new a.ARRAY_TYPE(l+this.arrayStep),this.invCs=new a.ARRAY_TYPE(l+this.arrayStep)),n(y);for(var A=this.invCs,b=this.Bs,y=this.lambda,m=0;m!==p.length;m++){var E=p[m];(E.timeStep!==t||E.needsUpdate)&&(E.timeStep=t,E.update()),b[m]=E.computeB(E.a,E.b,t),A[m]=E.computeInvC(E.epsilon)}var E,B,m,w;if(0!==l){for(m=0;m!==f;m++){var g=d[m];g.resetConstraintVelocity()}if(h){for(o=0;o!==h;o++){for(B=0,w=0;w!==l;w++){E=p[w];var P=i.iterateEquation(w,E,E.epsilon,b,A,y,v,t,o);B+=Math.abs(P)}if(this.usedIterations++,B*B<=u)break}for(i.updateMultipliers(p,y,1/t),w=0;w!==l;w++){var q=p[w];if(q instanceof c){for(var L=0,S=0;S!==q.contactEquations.length;S++)L+=q.contactEquations[S].multiplier;L*=q.frictionCoefficient/q.contactEquations.length,q.maxForce=L,q.minForce=-L}}}for(o=0;o!==s;o++){for(B=0,w=0;w!==l;w++){E=p[w];var P=i.iterateEquation(w,E,E.epsilon,b,A,y,v,t,o);B+=Math.abs(P)}if(this.usedIterations++,B*B<=u)break}for(m=0;m!==f;m++)d[m].addConstraintVelocity();i.updateMultipliers(p,y,1/t)}},i.updateMultipliers=function(t,e,o){for(var i=t.length;i--;)t[i].multiplier=e[i]*o},i.iterateEquation=function(t,e,o,i,n,r,s,a,c){var h=i[t],p=n[t],l=r[t],u=e.computeGWlambda(),d=e.maxForce,f=e.minForce;s&&(h=0);var v=p*(h-u-o*l),y=l+v;return y<f*a?v=f*a-l:y>d*a&&(v=d*a-l),r[t]+=v,e.addToWlambda(v),v}},91:function(t,e,o){function i(){r.apply(this,arguments)}var n=o(31),r=o(17);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},92:function(t,e,o){function i(){r.apply(this,arguments)}var n=o(19),r=o(17);t.exports=i,i.prototype=new r,i.prototype.constructor=i,i.prototype.create=function(){return new n},i.prototype.destroy=function(t){return t.bodyA=t.bodyB=null,this}},93:function(t,e){function o(t,e,o,i){this.shapeA=e,this.shapeB=i,this.bodyA=t,this.bodyB=o}t.exports=o,o.prototype.set=function(t,e,i,n){o.call(this,t,e,i,n)}},94:function(t,e,o){function i(){this.data={},this.keys=[]}var n=o(5);t.exports=i,i.prototype.getKey=function(t,e){return t|=0,e|=0,(0|t)===(0|e)?-1:0|((0|t)>(0|e)?t<<16|65535&e:e<<16|65535&t)},i.prototype.getByKey=function(t){return t|=0,this.data[t]},i.prototype.get=function(t,e){return this.data[this.getKey(t,e)]},i.prototype.set=function(t,e,o){if(!o)throw new Error("No data!");var i=this.getKey(t,e);return this.data[i]||this.keys.push(i),this.data[i]=o,i},i.prototype.reset=function(){for(var t=this.data,e=this.keys,o=e.length;o--;)delete t[e[o]];e.length=0},i.prototype.copy=function(t){this.reset(),n.appendArray(this.keys,t.keys);for(var e=t.keys.length;e--;){var o=t.keys[e];this.data[o]=t.data[o]}}},95:function(t,e,o){function i(){this.equations=[],this.bodies=[]}var n=o(15);t.exports=i,i.prototype.reset=function(){this.equations.length=this.bodies.length=0};var r=[];i.prototype.getBodies=function(t){var e=t||[],o=this.equations;r.length=0;for(var i=0;i!==o.length;i++){var n=o[i];r.indexOf(n.bodyA.id)===-1&&(e.push(n.bodyA),r.push(n.bodyA.id)),r.indexOf(n.bodyB.id)===-1&&(e.push(n.bodyB),r.push(n.bodyB.id))}return e},i.prototype.wantsToSleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];if(e.type===n.DYNAMIC&&!e.wantsToSleep)return!1}return!0},i.prototype.sleep=function(){for(var t=0;t<this.bodies.length;t++){var e=this.bodies[t];e.sleep()}return!0}},96:function(t,e){function o(t){this.body=t,this.neighbors=[],this.equations=[],this.visited=!1}t.exports=o,o.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}}});